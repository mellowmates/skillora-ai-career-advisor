<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skillora AI Career Advisor</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <!-- PDF libs for resume export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" integrity="sha512-BNaRQnYj1G8Y82z0RxEo7S22q6JrCwq3Yv+Q2mUedhDRuQ7oW0Zr2Qm+szF0mGZk9f9QhVv8B0QxzP2c3nT0Wg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" integrity="sha512-/O3a6O+0rD6qBf3bZy6gdDJPPmQZKz7p7bYukAlyQdIhieS2ah0+wCsfr1aZ0pbgC5HtcZtYf2SQl6xD/9W8hA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>
        :root {
            --primary: #059669;
            --primary-dark: #047857;
            --secondary: #10b981;
            --accent: #34d399;
            --bg-primary: #000000;
            --bg-secondary: #111111;
            --bg-tertiary: #1a1a1a;
            --text-primary: #ffffff;
            --text-secondary: #a3a3a3;
            --text-muted: #737373;
            --border: #262626;
            --border-light: #404040;
            --shadow: rgba(0, 0, 0, 0.5);
            --gradient-primary: linear-gradient(135deg, #059669 0%, #10b981 100%);
            --gradient-secondary: linear-gradient(135deg, #1a1a1a 0%, #262626 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Enhanced 3D Shader Background */
        #shader-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.4;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 70px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 700;
            font-size: 1.5rem;
            color: var(--text-primary);
            text-decoration: none;
        }

        .logo-icon {
            width: 32px;
            height: 32px;
            background: var(--gradient-primary);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: logoFloat 3s ease-in-out infinite;
        }

        @keyframes logoFloat {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-3px);
            }
        }

        .nav-tabs {
            display: flex;
            gap: 1.5rem;
            list-style: none;
        }

        .nav-tab {
            padding: 0.5rem 1rem;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: 500;
            position: relative;
            font-size: 0.9rem;
        }

        .nav-tab:hover,
        .nav-tab.active {
            color: var(--text-primary);
            background: var(--bg-tertiary);
        }

        .nav-tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 2px;
            background: var(--primary);
            border-radius: 1px;
        }



        /* Mobile Menu */
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 1.5rem;
            cursor: pointer;
        }

        /* Main Content */
        .main-content {
            margin-top: 70px;
            min-height: calc(100vh - 70px);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        /* Hero Section */
        .hero {
            padding: 4rem 0;
            text-align: center;
            position: relative;
        }

        .hero h1 {
            font-size: clamp(2.5rem, 5vw, 4rem);
            font-weight: 700;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, var(--text-primary) 0%, var(--accent) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: textGlow 2s ease-in-out infinite alternate;
        }

        @keyframes textGlow {
            from {
                filter: drop-shadow(0 0 5px rgba(52, 211, 153, 0.3));
            }

            to {
                filter: drop-shadow(0 0 20px rgba(52, 211, 153, 0.6));
            }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hero p {
            font-size: 1.25rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .cta-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 0.875rem 2rem;
            border-radius: 12px;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white;
            box-shadow: 0 4px 20px rgba(5, 150, 105, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 30px rgba(5, 150, 105, 0.4);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border-light);
        }

        .btn-secondary:hover {
            background: var(--bg-secondary);
            transform: translateY(-2px);
        }

        /* Features Grid */
        .features {
            padding: 4rem 0;
        }

        .features h2 {
            text-align: center;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 3rem;
            color: var(--text-primary);
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }

        .feature-card {
            background: var(--gradient-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 2rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--gradient-primary);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-4px) scale(1.02);
            border-color: var(--border-light);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .feature-card:hover::before {
            transform: scaleX(1);
        }

        .feature-icon {
            width: 48px;
            height: 48px;
            background: var(--gradient-primary);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1.5rem;
            animation: iconPulse 2s ease-in-out infinite;
        }

        @keyframes iconPulse {

            0%,
            100% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }
        }

        .feature-card h3 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .feature-card p {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* Section Styles */
        .section {
            display: none;
            padding: 2rem 0;
            animation: fadeInUp 0.5s ease-out;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 2rem;
            text-align: center;
            color: var(--text-primary);
        }

        /* Assessment Styles with enhanced animations */
        .assessment-container {
            max-width: 600px;
            margin: 0 auto;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--bg-tertiary);
            border-radius: 4px;
            margin-bottom: 2rem;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--gradient-primary);
            border-radius: 4px;
            transition: width 0.5s ease;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: progressShimmer 2s infinite;
        }

        @keyframes progressShimmer {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(100%);
            }
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-input {
            width: 100%;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 0.875rem;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(5, 150, 105, 0.1);
        }

        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.875rem;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .radio-option:hover {
            border-color: var(--border-light);
            background: var(--bg-primary);
            transform: translateX(5px);
        }

        .radio-option input[type="radio"] {
            margin: 0;
        }

        .step-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
        }

        /* Career Discovery (Tinder-style) Implementation */
        .career-stack {
            position: relative;
            width: 100%;
            max-width: 400px;
            height: 500px;
            margin: 2rem auto;
        }

        .career-card {
            position: absolute;
            width: 100%;
            height: 100%;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 2rem;
            cursor: grab;
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
            justify-content: center;
            text-align: center;
        }

        .career-card:active {
            cursor: grabbing;
        }

        .career-card.swiping {
            transition: none;
        }

        .career-card h3 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }

        .career-card p {
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
        }

        .career-actions {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 2rem;
        }

        .action-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .reject-btn {
            background: #ef4444;
            color: white;
        }

        .like-btn {
            background: var(--primary);
            color: white;
        }

        .action-btn:hover {
            transform: scale(1.1);
        }

        /* Career Values Quiz Implementation */
        .values-comparison {
            max-width: 600px;
            margin: 0 auto;
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 2rem;
        }

        .comparison-pair {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .value-option {
            flex: 1;
            padding: 2rem;
            background: var(--bg-tertiary);
            border: 2px solid var(--border);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .value-option:hover {
            border-color: var(--primary);
            transform: scale(1.02);
        }

        .value-option.selected {
            border-color: var(--primary);
            background: rgba(5, 150, 105, 0.1);
        }

        /* Career Pathway Timeline */
        .pathway-timeline {
            max-width: 800px;
            margin: 0 auto;
            position: relative;
        }

        .pathway-timeline::before {
            content: '';
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 2px;
            background: var(--gradient-primary);
            transform: translateX(-50%);
        }

        .pathway-step {
            display: flex;
            align-items: center;
            margin-bottom: 3rem;
            position: relative;
        }

        .pathway-step:nth-child(even) {
            flex-direction: row-reverse;
        }

        .step-content {
            flex: 1;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1.5rem;
            margin: 0 2rem;
        }

        .step-icon {
            width: 50px;
            height: 50px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            z-index: 1;
        }

        /* Resume Builder Split Layout */
        .resume-builder {
            display: grid;
            grid-template-columns: 1fr 1.2fr; /* give preview a bit more room */
            gap: 2rem;
            height: 90vh; /* increased to 90vh for more space */
            min-height: 800px; /* increased minimum height */
        }

        .resume-form {
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            padding: 2rem;
            overflow-y: auto;
        }

        .resume-preview {
            background: white;
            color: black;
            border-radius: 16px;
            padding: 0.5rem; /* minimal padding */
            overflow: auto; /* allow scrolling when content is larger than container */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            display: flex;
            justify-content: center;
            align-items: flex-start; /* align to top for better scrolling */
            position: relative; /* for proper scaling calculations */
        }

        .preview-controls {
            position: absolute;
            top: 1rem;
            right: 1rem;
            display: flex;
            gap: 0.5rem;
            z-index: 10;
            background: rgba(0, 0, 0, 0.8);
            padding: 0.5rem;
            border-radius: 8px;
            backdrop-filter: blur(10px);
        }

        .preview-control-btn {
            width: 32px;
            height: 32px;
            border: none;
            border-radius: 4px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: bold;
            font-size: 16px;
        }

        .preview-control-btn:hover {
            background: var(--primary);
            transform: scale(1.1);
        }

        .preview-control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .scale-indicator {
            color: var(--text-primary);
            font-size: 12px;
            margin: 0 0.5rem;
            display: flex;
            align-items: center;
            min-width: 40px;
            justify-content: center;
        }

        /* On-screen zoom for the preview (not used in PDF export) */
        .preview-zoom {
            /* scale is dynamically computed in JS to ensure full fit */
            transform-origin: top center;
            will-change: transform;
        }

        /* Chat Interface */
        .chat-container {
            display: none;
            max-width: 800px;
            margin: 2rem auto;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: 16px;
            overflow: hidden;
            height: 600px;
            display: flex;
            flex-direction: column;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .chat-header {
            background: var(--gradient-primary);
            padding: 1rem 1.5rem;
            color: white;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .chat-messages {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .message {
            display: flex;
            gap: 0.75rem;
            max-width: 80%;
            animation: slideIn 0.3s ease;
        }

        .message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .message-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .message.user .message-avatar {
            background: var(--bg-tertiary);
        }

        .message-content {
            background: var(--bg-tertiary);
            padding: 0.875rem 1.25rem;
            border-radius: 16px;
            color: var(--text-primary);
            line-height: 1.5;
        }

        .message.user .message-content {
            background: var(--gradient-primary);
            color: white;
        }

        .chat-input {
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 0.75rem;
        }

        .chat-input input {
            flex: 1;
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 0.875rem 1rem;
            color: var(--text-primary);
            font-size: 1rem;
        }

        .chat-input input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .chat-input button {
            background: var(--gradient-primary);
            border: none;
            border-radius: 12px;
            padding: 0.875rem 1.25rem;
            color: white;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .chat-input button:hover {
            transform: scale(1.05);
        }

        /* Floating Chat Button */
        .floating-chat {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            background: var(--gradient-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 8px 30px rgba(5, 150, 105, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
            animation: floatingBounce 3s ease-in-out infinite;
        }

        @keyframes floatingBounce {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        .floating-chat:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 40px rgba(5, 150, 105, 0.4);
        }

        .floating-chat svg {
            width: 24px;
            height: 24px;
            fill: white;
        }

        /* Animations */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .typing-indicator {
            display: flex;
            gap: 4px;
            padding: 1rem;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--text-secondary);
            border-radius: 50%;
            animation: pulse 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .nav-tabs {
                display: none;
            }

            .mobile-menu-btn {
                display: block;
            }

            .hero h1 {
                font-size: 2.5rem;
            }

            .hero p {
                font-size: 1.125rem;
            }

            .cta-buttons {
                flex-direction: column;
                align-items: center;
            }

            .features-grid {
                grid-template-columns: 1fr;
            }

            .chat-container {
                margin: 1rem;
                height: calc(100vh - 140px);
            }

            .floating-chat {
                bottom: 1rem;
                right: 1rem;
            }

            .resume-builder {
                grid-template-columns: 1fr;
                height: auto;
            }

            .pathway-timeline::before {
                left: 20px;
            }

            .pathway-step {
                flex-direction: row !important;
                padding-left: 50px;
            }

            .step-content {
                margin-left: 1rem;
                margin-right: 0;
            }
        }
    </style>
</head>

<body>
    <!-- Enhanced 3D Shader Canvas -->
    <canvas id="shader-canvas"></canvas>

    <!-- Header -->
    <header class="header">
        <nav class="nav-container">
            <a href="#" class="logo">
                <div class="logo-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
                    </svg>
                </div>
                Skillora AI
            </a>

            <ul class="nav-tabs">
                <li><a href="#" class="nav-tab active" data-section="home">Home</a></li>
                <li><a href="#" class="nav-tab" data-section="assessment">Assessment</a></li>
                <li class="assessment-required" style="display: none;"><a href="#" class="nav-tab" data-section="dashboard">Dashboard</a></li>
                <li class="assessment-required" style="display: none;"><a href="#" class="nav-tab" data-section="discovery">Discovery</a></li>
                <li class="assessment-required" style="display: none;"><a href="#" class="nav-tab" data-section="values">Values</a></li>
                <li class="assessment-required" style="display: none;"><a href="#" class="nav-tab" data-section="pathway">Pathway</a></li>
                <li><a href="#" class="nav-tab" data-section="resume">Resume</a></li>
                <li><a href="#" class="nav-tab" data-section="chat">AI Chat</a></li>
            </ul>

            <button class="mobile-menu-btn">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M3 12h18M3 6h18M3 18h18" />
                </svg>
            </button>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Home Section -->
        <section id="home" class="section active">
            <div class="hero">
                <div class="container">
                    <h1>AI-Powered Career Guidance</h1>
                    <p>Discover your perfect career path with personalized AI insights, skill assessments, and
                        professional guidance tailored for your success.</p>
                    <div class="cta-buttons">
                        <a href="#" class="btn btn-primary" data-section="assessment">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            Start Assessment
                        </a>
                        <a href="#" class="btn btn-secondary" data-section="chat">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path
                                    d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
                            </svg>
                            Chat with AI
                        </a>

                    </div>
                </div>
            </div>

            <div class="features">
                <div class="container">
                    <h2>Powerful Features</h2>
                    <div class="features-grid">
                        <div class="feature-card">
                            <div class="feature-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                                    <path
                                        d="M9.663 17h4.673M12 3v1m6.364-.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
                                </svg>
                            </div>
                            <h3>Smart Career Matching</h3>
                            <p>Advanced AI algorithms analyze your skills, interests, and goals to recommend the perfect
                                career paths tailored specifically for you.</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                                    <path d="M13 10V3L4 14h7v7l9-11h-7z" />
                                </svg>
                            </div>
                            <h3>Skill Development Plans</h3>
                            <p>Get personalized learning roadmaps with specific courses, certifications, and resources
                                to bridge skill gaps in your chosen field.</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                                    <path
                                        d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                                </svg>
                            </div>
                            <h3>Market Insights</h3>
                            <p>Access real-time job market data, salary trends, and industry growth projections to make
                                informed career decisions.</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                                    <path
                                        d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                                </svg>
                            </div>
                            <h3>Interactive Learning</h3>
                            <p>Engage with gamified assessments, career discovery tools, and interactive content
                                designed to make learning enjoyable.</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                                    <path
                                        d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                            </div>
                            <h3>AI Resume Builder</h3>
                            <p>Create professional, ATS-optimized resumes with AI-powered content suggestions and
                                industry-specific templates.</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                                    <path
                                        d="M17 8h2a2 2 0 012 2v6a2 2 0 01-2 2h-2v4l-4-4H9a1.994 1.994 0 01-1.414-.586m0 0L11 14h4a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2v4l.586-.586z" />
                                </svg>
                            </div>
                            <h3>24/7 AI Support</h3>
                            <p>Get instant answers to your career questions with our intelligent chatbot, available
                                round the clock for guidance and support.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Assessment Section -->
        <section id="assessment" class="section">
            <div class="container">
                <h2 class="section-title">Career Assessment</h2>
                <div class="assessment-container">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 16.67%"></div>
                    </div>
                    <div id="assessment-content">
                        <h3>Step 1: Experience Level</h3>
                        <div class="form-group">
                            <label class="form-label">What's your current experience level?</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="experience" value="student">
                                    <span>Student / Fresh Graduate</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="experience" value="entry">
                                    <span>Entry Level (0-2 years)</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="experience" value="mid">
                                    <span>Mid Level (3-5 years)</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="experience" value="senior">
                                    <span>Senior Level (5+ years)</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="step-navigation">
                        <button class="btn btn-secondary" disabled>Previous</button>
                        <button class="btn btn-primary">Next</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Dashboard Section -->
        <section id="dashboard" class="section">
            <div class="container">
                <h2 class="section-title">Your Career Dashboard</h2>
                <div class="features-grid">
                    <div class="feature-card">
                        <h3>Top Career Matches</h3>
                        <div style="margin: 1rem 0;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Software Engineer</span>
                                <span>95%</span>
                            </div>
                            <div class="progress-bar" style="margin-bottom: 1rem;">
                                <div class="progress-fill" style="width: 95%"></div>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Data Scientist</span>
                                <span>88%</span>
                            </div>
                            <div class="progress-bar" style="margin-bottom: 1rem;">
                                <div class="progress-fill" style="width: 88%"></div>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Product Manager</span>
                                <span>82%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: 82%"></div>
                            </div>
                        </div>
                    </div>
                    <div class="feature-card">
                        <h3>Skill Development Plan</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;">Recommended skills to enhance your
                            profile:</p>
                        <ul style="list-style: none; padding: 0;">
                            <li style="padding: 0.5rem 0; border-bottom: 1px solid var(--border);">
                                <strong>React.js</strong> - Frontend Development
                            </li>
                            <li style="padding: 0.5rem 0; border-bottom: 1px solid var(--border);">
                                <strong>Python</strong> - Data Analysis
                            </li>
                            <li style="padding: 0.5rem 0;">
                                <strong>AWS</strong> - Cloud Computing
                            </li>
                        </ul>
                    </div>
                    <div class="feature-card">
                        <h3>Market Insights</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 1rem;">Current market trends in your
                            field:</p>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span>Job Growth</span>
                            <span style="color: var(--accent);">+15%</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span>Avg. Salary</span>
                            <span>₹12-18 LPA</span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span>Remote Jobs</span>
                            <span style="color: var(--accent);">65%</span>
                        </div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 2rem;">
                    <button class="btn btn-primary">Generate Resume with AI</button>
                </div>
            </div>
        </section>

        <!-- Enhanced Career Discovery Section -->
        <section id="discovery" class="section">
            <div class="container">
                <h2 class="section-title">Career Discovery</h2>
                <p style="text-align: center; color: var(--text-secondary); margin-bottom: 2rem;">
                    Swipe through different careers to discover what interests you most
                </p>

                <!-- Career Stats -->
                <div id="discovery-stats" style="display: flex; justify-content: center; gap: 2rem; margin-bottom: 2rem; display: none;">
                    <div style="text-align: center;">
                        <div id="liked-count" style="font-size: 1.5rem; font-weight: 600; color: var(--accent);">0</div>
                        <div style="color: var(--text-secondary); font-size: 0.9rem;">Liked</div>
                    </div>
                    <div style="text-align: center;">
                        <div id="remaining-count" style="font-size: 1.5rem; font-weight: 600; color: var(--text-secondary);">0</div>
                        <div style="color: var(--text-secondary); font-size: 0.9rem;">Remaining</div>
                    </div>
                    <div style="text-align: center;">
                        <div id="passed-count" style="font-size: 1.5rem; font-weight: 600; color: var(--danger);">0</div>
                        <div style="color: var(--text-secondary); font-size: 0.9rem;">Passed</div>
                    </div>
                </div>

                <div class="career-stack" id="career-stack">
                    <!-- Default message when no assessment data -->
                    <div id="no-assessment-message" style="text-align: center; color: var(--text-secondary); padding: 2rem;">
                        Complete your assessment first to discover personalized careers!
                        <br><br>
                        <button class="btn btn-primary" onclick="showSection('assessment')">Take Assessment</button>
                    </div>
                    
                    <!-- Loading state -->
                    <div id="loading-message" style="text-align: center; color: var(--text-secondary); padding: 2rem; display: none;">
                        <div style="margin-bottom: 1rem;">
                            <div style="width: 40px; height: 40px; border: 3px solid var(--border); border-top: 3px solid var(--accent); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto;"></div>
                        </div>
                        Loading personalized career suggestions...
                    </div>
                    
                    <!-- Career cards will be populated here -->
                </div>

                <div class="career-actions" id="career-actions" style="display: none;">
                    <button class="action-btn reject-btn" onclick="swipeCard('reject')" id="reject-btn">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                    <button class="action-btn like-btn" onclick="swipeCard('like')" id="like-btn">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path
                                d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                        </svg>
                    </button>
                </div>
            </div>
        </section>

        <!-- Career Values Quiz Section -->
        <section id="values" class="section">
            <div class="container">
                <h2 class="section-title">Career Values Quiz</h2>
                <p style="text-align: center; color: var(--text-secondary); margin-bottom: 2rem;">
                    Choose what matters most to you in your career
                </p>

                <div class="values-comparison">
                    <div class="progress-bar">
                        <div class="progress-fill" id="values-progress" style="width: 20%"></div>
                    </div>

                    <div id="values-question">
                        <h3 style="text-align: center; margin-bottom: 2rem;">What's more important to you?</h3>
                        <div class="comparison-pair">
                            <div class="value-option" data-value="work-life-balance">
                                <h4>Work-Life Balance</h4>
                                <p>Having time for personal life, family, and hobbies</p>
                            </div>
                            <div class="value-option" data-value="high-salary">
                                <h4>High Salary</h4>
                                <p>Earning a substantial income and financial security</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Career Pathway Section -->
        <section id="pathway" class="section">
            <div class="container">
                <h2 class="section-title">Career Pathway</h2>
                <p style="text-align: center; color: var(--text-secondary); margin-bottom: 3rem;">
                    Your personalized roadmap to becoming a Software Engineer
                </p>

                <div class="pathway-timeline">
                    <div class="pathway-step">
                        <div class="step-content">
                            <h3>Learn Programming Fundamentals</h3>
                            <p>Master Python, JavaScript, and basic computer science concepts</p>
                            <div style="color: var(--accent); font-weight: 600; margin-top: 0.5rem;">3-6 months •
                                ₹15,000</div>
                        </div>
                        <div class="step-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                                <path
                                    d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                            </svg>
                        </div>
                    </div>

                    <div class="pathway-step">
                        <div class="step-content">
                            <h3>Build Projects</h3>
                            <p>Create 3-5 portfolio projects showcasing your skills</p>
                            <div style="color: var(--accent); font-weight: 600; margin-top: 0.5rem;">2-4 months • Free
                            </div>
                        </div>
                        <div class="step-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                                <path
                                    d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" />
                            </svg>
                        </div>
                    </div>

                    <div class="pathway-step">
                        <div class="step-content">
                            <h3>Get Certified</h3>
                            <p>Obtain relevant certifications in your chosen technology stack</p>
                            <div style="color: var(--accent); font-weight: 600; margin-top: 0.5rem;">1-2 months •
                                ₹25,000</div>
                        </div>
                        <div class="step-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                                <path
                                    d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z" />
                            </svg>
                        </div>
                    </div>

                    <div class="pathway-step">
                        <div class="step-content">
                            <h3>Apply for Jobs</h3>
                            <p>Start applying to entry-level positions and internships</p>
                            <div style="color: var(--accent); font-weight: 600; margin-top: 0.5rem;">1-3 months • Free
                            </div>
                        </div>
                        <div class="step-icon">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                                <path
                                    d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2-2v2m8 0H8m8 0v6a2 2 0 01-2 2H10a2 2 0 01-2-2V6m8 0H8" />
                            </svg>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Resume Builder Section -->
        <!-- Resume Builder Section -->
        <section id="resume" class="section">
            <!-- Content will be dynamically generated by renderResumeBuilder() function -->
        </section>

        <!-- Chat Section -->
        <section id="chat" class="section">
            <div class="container">
                <div class="chat-container" style="display: flex;">
                    <div class="chat-header">
                        <div class="message-avatar">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
                                <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
                            </svg>
                        </div>
                        <span>Skillora AI Assistant</span>
                    </div>
                    <div class="chat-messages" id="chat-messages">
                        <div class="message">
                            <div class="message-avatar">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="white">
                                    <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
                                </svg>
                            </div>
                            <div class="message-content">
                                Hello! I'm your AI career advisor. I can help you with career guidance, skill
                                development, resume tips, and answer any questions about your professional journey. How
                                can I assist you today?
                            </div>
                        </div>
                    </div>
                    <div class="chat-input">
                        <input type="text" id="chat-input" placeholder="Ask me anything about your career...">
                        <button id="send-btn">Send</button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Floating Chat Button -->
    <div class="floating-chat" id="floating-chat">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
            <path
                d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
        </svg>
    </div>

    <script>
        // Ensure PDF libraries are loaded with fallback CDNs
        async function ensurePdfLibsLoaded() {
            function loadScript(src, attrs = {}) {
                return new Promise((resolve, reject) => {
                    const s = document.createElement('script');
                    s.src = src;
                    Object.entries(attrs).forEach(([k, v]) => s.setAttribute(k, v));
                    s.onload = () => resolve(true);
                    s.onerror = () => reject(new Error('Failed to load ' + src));
                    document.head.appendChild(s);
                });
            }

            const html2canvasLoaded = typeof window.html2canvas !== 'undefined';
            const jsPdfLoaded = typeof window.jspdf !== 'undefined' && typeof window.jspdf.jsPDF !== 'undefined';

            if (html2canvasLoaded && jsPdfLoaded) return true;

            const html2canvasCDNs = [
                'https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js',
                'https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js',
                'https://unpkg.com/html2canvas@1.4.1/dist/html2canvas.min.js'
            ];
            const jsPdfCDNs = [
                'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js',
                'https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js',
                'https://unpkg.com/jspdf@2.5.1/dist/jspdf.umd.min.js'
            ];

            // Try loading missing libraries with fallbacks
            if (!html2canvasLoaded) {
                for (const url of html2canvasCDNs) {
                    try { await loadScript(url); break; } catch (e) { /* try next */ }
                }
            }
            if (!jsPdfLoaded) {
                for (const url of jsPdfCDNs) {
                    try { await loadScript(url); break; } catch (e) { /* try next */ }
                }
            }

            return (typeof window.html2canvas !== 'undefined') && (typeof window.jspdf !== 'undefined' && typeof window.jspdf.jsPDF !== 'undefined');
        }
        // Application State Management
        const AppState = {
            currentStep: 0,
            totalSteps: 0, // Will be set dynamically based on assessmentQuestions length
            assessmentData: {
                experience: '',
                education: '',
                interestField: '',
                techSkills: '',
                goals: '',
                careerValues: []
            },
            dashboardData: null,
            careerCards: [],
            likedCareers: [],
            rejectedCareers: [],
            currentCardIndex: 0,
            chatMessages: [
                { role: 'bot', content: 'Hello! I\'m your AI Career Advisor. I can help you with career guidance, skill development, resume tips, and answer any questions about your professional journey. How can I assist you today?' }
            ],
            resumeData: {
                personal_info: {
                    name: '',
                    email: '',
                    phone: '',
                    linkedin: '',
                    github: '',
                    location: ''
                },
                summary: '',
                experience: [],
                education: [],
                skills: {
                    programming_languages: [],
                    frameworks: [],
                    developer_tools: [],
                    soft_skills: []
                },
                projects: []
            },
            selectedCareer: null,
            careerPathway: null,
            topValues: null,
            isLoading: false,
            resumeScale: 1.0, // Track current resume scale level
            minScale: 0.3,    // Minimum zoom level
            maxScale: 2.0     // Maximum zoom level
        };

        const canvas = document.getElementById('shader-canvas');
        const gl = canvas.getContext('webgl');

        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            if (gl) {
                gl.viewport(0, 0, canvas.width, canvas.height);
            }
        }

        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // Enhanced 3D shader with particle effects and dynamic lighting
        function initShaders() {
            if (!gl) return;

            const vertexShaderSource = `
                attribute vec2 a_position;
                void main() {
                    gl_Position = vec4(a_position, 0.0, 1.0);
                }
            `;

            const fragmentShaderSource = `
                precision mediump float;
                uniform float u_time;
                uniform vec2 u_resolution;
                uniform vec2 u_mouse;
                
                // Noise function for organic movement
                float noise(vec2 st) {
                    return fract(sin(dot(st.xy, vec2(12.9898,78.233))) * 43758.5453123);
                }
                
                // Smooth noise
                float smoothNoise(vec2 st) {
                    vec2 i = floor(st);
                    vec2 f = fract(st);
                    float a = noise(i);
                    float b = noise(i + vec2(1.0, 0.0));
                    float c = noise(i + vec2(0.0, 1.0));
                    float d = noise(i + vec2(1.0, 1.0));
                    vec2 u = f * f * (3.0 - 2.0 * f);
                    return mix(a, b, u.x) + (c - a) * u.y * (1.0 - u.x) + (d - b) * u.x * u.y;
                }
                
                // Fractal noise
                float fractalNoise(vec2 st) {
                    float value = 0.0;
                    float amplitude = 0.5;
                    for (int i = 0; i < 6; i++) {
                        value += amplitude * smoothNoise(st);
                        st *= 2.0;
                        amplitude *= 0.5;
                    }
                    return value;
                }
                
                void main() {
                    vec2 st = gl_FragCoord.xy / u_resolution.xy;
                    vec2 mouse = u_mouse / u_resolution.xy;
                    
                    // Create flowing energy patterns
                    vec2 pos = st * 3.0;
                    pos += vec2(sin(u_time * 0.3), cos(u_time * 0.2)) * 0.5;
                    
                    // Add mouse interaction
                    float mouseInfluence = 1.0 - length(st - mouse) * 2.0;
                    mouseInfluence = max(0.0, mouseInfluence);
                    
                    // Generate flowing noise patterns
                    float n1 = fractalNoise(pos + u_time * 0.1);
                    float n2 = fractalNoise(pos * 1.5 - u_time * 0.15);
                    float n3 = fractalNoise(pos * 2.0 + u_time * 0.08);
                    
                    // Create energy waves
                    float wave1 = sin(st.x * 10.0 + u_time * 2.0) * 0.1;
                    float wave2 = cos(st.y * 8.0 + u_time * 1.5) * 0.1;
                    float wave3 = sin((st.x + st.y) * 12.0 + u_time * 3.0) * 0.05;
                    
                    // Combine all effects
                    float intensity = n1 * 0.4 + n2 * 0.3 + n3 * 0.2;
                    intensity += wave1 + wave2 + wave3;
                    intensity += mouseInfluence * 0.3;
                    
                    // Create particle-like effects
                    float particles = 0.0;
                    for (int i = 0; i < 8; i++) {
                        vec2 particlePos = vec2(
                            sin(u_time * 0.5 + float(i) * 0.8) * 0.3 + 0.5,
                            cos(u_time * 0.3 + float(i) * 1.2) * 0.3 + 0.5
                        );
                        float dist = length(st - particlePos);
                        particles += 0.02 / (dist + 0.1);
                    }
                    
                    // Color mixing with green theme
                    vec3 color1 = vec3(0.02, 0.4, 0.2);  // Dark green
                    vec3 color2 = vec3(0.05, 0.6, 0.4);  // Medium green
                    vec3 color3 = vec3(0.2, 0.8, 0.6);   // Light green
                    
                    vec3 finalColor = mix(color1, color2, intensity);
                    finalColor = mix(finalColor, color3, particles);
                    
                    // Add subtle blue accents
                    finalColor += vec3(0.0, 0.1, 0.3) * sin(u_time + st.x * 5.0) * 0.1;
                    
                    // Enhance contrast and add glow
                    finalColor *= 1.2;
                    finalColor += vec3(0.05, 0.2, 0.15) * intensity;
                    
                    gl_FragColor = vec4(finalColor, 1.0);
                }
            `;

            function createShader(gl, type, source) {
                const shader = gl.createShader(type);
                gl.shaderSource(shader, source);
                gl.compileShader(shader);
                if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {
                    console.error('ERROR compiling shader:', gl.getShaderInfoLog(shader));
                    gl.deleteShader(shader);
                    return null;
                }
                return shader;
            }

            const vertexShader = createShader(gl, gl.VERTEX_SHADER, vertexShaderSource);
            const fragmentShader = createShader(gl, gl.FRAGMENT_SHADER, fragmentShaderSource);

            if (!vertexShader || !fragmentShader) {
                console.error('Failed to create shaders.');
                return null;
            }

            const program = gl.createProgram();
            gl.attachShader(program, vertexShader);
            gl.attachShader(program, fragmentShader);
            gl.linkProgram(program);

            if (!gl.getProgramParameter(program, gl.LINK_STATUS)) {
                console.error('ERROR linking program:', gl.getProgramInfoLog(program));
                gl.deleteProgram(program);
                return null;
            }

            const positionBuffer = gl.createBuffer();
            gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
            gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([
                -1, -1, 1, -1, -1, 1, -1, 1, 1, -1, 1, 1
            ]), gl.STATIC_DRAW);

            const positionLocation = gl.getAttribLocation(program, 'a_position');
            const timeLocation = gl.getUniformLocation(program, 'u_time');
            const resolutionLocation = gl.getUniformLocation(program, 'u_resolution');
            const mouseLocation = gl.getUniformLocation(program, 'u_mouse');

            let mouseX = 0, mouseY = 0;

            canvas.addEventListener('mousemove', (e) => {
                mouseX = e.clientX;
                mouseY = canvas.height - e.clientY; // Invert Y for GLSL coordinate system
            });

            function animate(time) {
                gl.useProgram(program);
                gl.enableVertexAttribArray(positionLocation);
                gl.bindBuffer(gl.ARRAY_BUFFER, positionBuffer);
                gl.vertexAttribPointer(positionLocation, 2, gl.FLOAT, false, 0, 0);

                gl.uniform1f(timeLocation, time * 0.001);
                gl.uniform2f(resolutionLocation, canvas.width, canvas.height);
                gl.uniform2f(mouseLocation, mouseX, mouseY);

                gl.drawArrays(gl.TRIANGLES, 0, 6);
                requestAnimationFrame(animate);
            }

            animate(0);
            return program;
        }

        // Initialize shaders
        if (gl) {
            initShaders();
        }

        // Navigation - Initialize after DOM is loaded
        let navTabs, sections;

        function initNavigation() {
            navTabs = document.querySelectorAll('.nav-tab');
            sections = document.querySelectorAll('.section');

            console.log('Found nav tabs:', navTabs.length);
            console.log('Found sections:', sections.length);

            navTabs.forEach(tab => {
                tab.addEventListener('click', (e) => {
                    e.preventDefault();
                    console.log('Nav tab clicked:', tab);
                    const sectionId = tab.getAttribute('data-section');
                    if (sectionId) {
                        showSection(sectionId);
                    }
                });
            });
        }

        function showSection(sectionId) {
            console.log('Showing section:', sectionId);

            if (!sections) {
                console.error('Sections not initialized');
                return;
            }

            // Check if user is trying to access assessment-required sections without completing assessment
            const assessmentRequiredSections = ['dashboard', 'discovery', 'values', 'pathway'];
            if (assessmentRequiredSections.includes(sectionId) && !AppState.assessmentData.experience) {
                alert('Please complete your assessment first to access this section.');
                showSection('assessment');
                return;
            }

            sections.forEach(section => {
                section.classList.remove('active');
            });
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.add('active');
                console.log('Section activated:', sectionId);
                if (sectionId === 'resume') {
                    // Ensure resume builder exists and fit the preview once
                    if (!document.getElementById('resume-preview-content')) {
                        renderResumeBuilder();
                    } else {
                        // Just refit if already exists
                        fitResumePreview();
                    }
                }
            } else {
                console.error('Section not found:', sectionId);
            }

            if (navTabs) {
                navTabs.forEach(tab => {
                    tab.classList.remove('active');
                });
                const activeTab = document.querySelector(`[data-section="${sectionId}"]`);
                if (activeTab) {
                    activeTab.classList.add('active');
                }
            }

            // Special handling for assessment section - always initialize properly
            if (sectionId === 'assessment') {
                // Reset assessment state and initialize
                AppState.currentStep = 0;
                AppState.totalSteps = assessmentQuestions.length;
                initAssessment();
            }

            // Special handling for discovery section
            if (sectionId === 'discovery') {
                // Use immediate execution instead of setTimeout for better responsiveness
                setTimeout(() => {
                    console.log('Discovery section activated, checking for career cards...');
                    console.log('Current assessment data:', AppState.assessmentData);
                    console.log('Current career cards:', AppState.careerCards);
                    
                    // Check if we already have data but UI is not updated
                    if (AppState.careerCards && AppState.careerCards.length > 0) {
                        console.log('Career cards already loaded, rendering...');
                        renderCareerCards();
                        updateDiscoveryStats();
                        
                        // Force show all elements
                        const noAssessmentMsg = document.getElementById('no-assessment-message');
                        const loadingMsg = document.getElementById('loading-message');
                        const discoveryStats = document.getElementById('discovery-stats');
                        const careerActions = document.getElementById('career-actions');
                        
                        if (noAssessmentMsg) noAssessmentMsg.style.display = 'none';
                        if (loadingMsg) loadingMsg.style.display = 'none';
                        if (discoveryStats) discoveryStats.style.display = 'flex';
                        if (careerActions) careerActions.style.display = 'flex';
                    } else {
                        loadCareerCards();
                    }
                }, 100);
            }
        }

        // Navigation is now handled in initNavigation()

        // This will be handled in the main DOMContentLoaded event

        // Initialize career discovery action buttons
        document.addEventListener('DOMContentLoaded', function () {
            const likeBtn = document.getElementById('like-btn');
            const rejectBtn = document.getElementById('reject-btn');

            if (likeBtn) likeBtn.addEventListener('click', () => swipeCard('like'));
            if (rejectBtn) rejectBtn.addEventListener('click', () => swipeCard('reject'));
        });


        // Global functions for onclick handlers
        window.generateCareerPathway = generateCareerPathway;
        window.generateAIResume = generateAIResume;
        window.generateResumeFromLikes = generateResumeFromLikes;
        window.downloadResumePDF = downloadResumePDF;
        window.updateResumePreview = updateResumePreview;
        window.swipeCard = swipeCard;
        window.resetDiscovery = resetDiscovery;
        window.initValuesQuiz = initValuesQuiz;
        window.showSection = showSection;
        window.zoomIn = zoomIn;
        window.zoomOut = zoomOut;
        window.resetZoom = resetZoom;
        
        // Debug function to check state
        window.debugDiscoveryState = function() {
            console.log('=== Discovery Debug Info ===');
            console.log('AppState.assessmentData:', AppState.assessmentData);
            console.log('AppState.careerCards:', AppState.careerCards);
            console.log('Current card index:', AppState.currentCardIndex);
            
            const noAssessmentMsg = document.getElementById('no-assessment-message');
            const loadingMsg = document.getElementById('loading-message');
            const discoveryStats = document.getElementById('discovery-stats');
            const careerActions = document.getElementById('career-actions');
            const careerStack = document.getElementById('career-stack');
            
            console.log('UI Elements visibility:');
            console.log('- No assessment message:', noAssessmentMsg ? noAssessmentMsg.style.display : 'not found');
            console.log('- Loading message:', loadingMsg ? loadingMsg.style.display : 'not found');
            console.log('- Discovery stats:', discoveryStats ? discoveryStats.style.display : 'not found');
            console.log('- Career actions:', careerActions ? careerActions.style.display : 'not found');
            console.log('- Career stack children:', careerStack ? careerStack.children.length : 'not found');
            
            return { AppState, elements: { noAssessmentMsg, loadingMsg, discoveryStats, careerActions, careerStack } };
        };

        // API Integration Functions
        async function callAPI(endpoint, data = null, method = 'GET') {
            const options = {
                method: method,
                headers: {
                    'Content-Type': 'application/json',
                }
            };

            if (data && method !== 'GET') {
                options.body = JSON.stringify(data);
            }

            try {
                const response = await fetch(endpoint, options);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                return await response.json();
            } catch (error) {
                console.error(`API Error (${endpoint}):`, error);
                throw error;
            }
        }

        // Assessment Functions
        const assessmentQuestions = [
            {
                id: 'experience',
                title: 'Professional Experience',
                question: 'What is your level of professional experience?',
                type: 'radio',
                options: ['Fresher (0-1 year)', 'Early Career (2-5 years)', 'Mid-Career (6-10 years)', 'Senior Level (10+ years)']
            },
            {
                id: 'education',
                title: 'Educational Background',
                question: 'What is your highest educational qualification?',
                type: 'text',
                placeholder: 'e.g., B.Tech in Computer Science, MBA in Marketing'
            },
            {
                id: 'interestField',
                title: 'Field of Interest',
                question: 'Which field are you most interested in?',
                type: 'radio',
                options: ['Software Development', 'Data Science & Analytics', 'Cybersecurity', 'Cloud Computing', 'Product Management', 'UX/UI Design']
            },
            {
                id: 'techSkills',
                title: 'Technical Skills',
                question: 'List any programming languages, frameworks, or tools you know.',
                type: 'textarea',
                placeholder: 'e.g., Python, JavaScript, React, TensorFlow, AWS'
            },
            {
                id: 'goals',
                title: 'Career Goals',
                question: 'Briefly describe your primary career aspirations.',
                type: 'textarea',
                placeholder: 'e.g., To become a senior AI engineer, lead a design team...'
            },
            {
                id: 'careerValues',
                title: 'Career Values',
                question: 'What are the most important factors in your ideal career? (Select up to 3)',
                type: 'checkbox',
                options: ['High earning potential', 'Work-life balance', 'Creative expression', 'Leadership opportunities', 'Making a positive impact', 'Job security', 'Remote work flexibility', 'Cutting-edge technology']
            }
        ];

        function renderAssessmentStep() {
            const question = assessmentQuestions[AppState.currentStep];
            const progress = ((AppState.currentStep + 1) / AppState.totalSteps) * 100;

            document.querySelector('.progress-fill').style.width = `${progress}%`;

            let inputHTML = '';

            if (question.type === 'radio') {
                inputHTML = `
                    <div class="radio-group">
                        ${question.options.map(option => `
                            <label class="radio-option">
                                <input type="radio" name="${question.id}" value="${option}" 
                                       ${AppState.assessmentData[question.id] === option ? 'checked' : ''}>
                                <span>${option}</span>
                            </label>
                        `).join('')}
                    </div>
                `;
            } else if (question.type === 'text' || question.type === 'textarea') {
                const tag = question.type === 'textarea' ? 'textarea' : 'input';
                inputHTML = `<${tag} class="form-input" placeholder="${question.placeholder}" 
                                    ${question.type === 'textarea' ? 'rows="4"' : 'type="text"'}>${AppState.assessmentData[question.id] || ''}</${tag}>`;
            } else if (question.type === 'checkbox') {
                inputHTML = `
                    <div class="radio-group">
                        ${question.options.map(option => `
                            <label class="radio-option">
                                <input type="checkbox" value="${option}" 
                                       ${AppState.assessmentData[question.id].includes(option) ? 'checked' : ''}>
                                <span>${option}</span>
                            </label>
                        `).join('')}
                    </div>
                `;
            }

            document.getElementById('assessment-content').innerHTML = `
                <h3>Step ${AppState.currentStep + 1}: ${question.title}</h3>
                <div class="form-group">
                    <label class="form-label">${question.question}</label>
                    ${inputHTML}
                </div>
            `;

            // Update navigation buttons
            const prevBtn = document.querySelector('.step-navigation .btn-secondary');
            const nextBtn = document.querySelector('.step-navigation .btn-primary');

            prevBtn.disabled = AppState.currentStep === 0;
            nextBtn.textContent = AppState.currentStep === AppState.totalSteps - 1 ? 'Get Results' : 'Next';
        }

        function saveCurrentStep() {
            const question = assessmentQuestions[AppState.currentStep];
            const container = document.getElementById('assessment-content');

            if (question.type === 'radio') {
                const selected = container.querySelector(`input[name="${question.id}"]:checked`);
                if (selected) {
                    AppState.assessmentData[question.id] = selected.value;
                    console.log(`Saved ${question.id}:`, selected.value);
                }
            } else if (question.type === 'text' || question.type === 'textarea') {
                const input = container.querySelector('.form-input');
                if (input) {
                    AppState.assessmentData[question.id] = input.value;
                    console.log(`Saved ${question.id}:`, input.value);
                }
            } else if (question.type === 'checkbox') {
                const selected = Array.from(container.querySelectorAll('input[type="checkbox"]:checked'))
                    .map(cb => cb.value);
                AppState.assessmentData[question.id] = selected;
                console.log(`Saved ${question.id}:`, selected);
            }
        }

        async function submitAssessment() {
            AppState.isLoading = true;
            try {
                // Use the correct Flask route
                const result = await callAPI('/api/analyze', AppState.assessmentData, 'POST');
                AppState.dashboardData = result;

                // Also fetch career suggestions for discovery
                const suggestions = await callAPI('/api/career-cards', AppState.assessmentData, 'POST');
                AppState.careerCards = suggestions;
                AppState.currentCardIndex = 0;

                // Show assessment-required tabs
                showAssessmentRequiredTabs();

                showSection('dashboard');
                renderDashboard();
            } catch (error) {
                console.error('Assessment submission error:', error);
                alert('Failed to analyze your profile. Please try again.');
            } finally {
                AppState.isLoading = false;
            }
        }

        function showAssessmentRequiredTabs() {
            const assessmentRequiredTabs = document.querySelectorAll('.assessment-required');
            assessmentRequiredTabs.forEach(tab => {
                tab.style.display = 'list-item';
            });
        }

        function hideAssessmentRequiredTabs() {
            const assessmentRequiredTabs = document.querySelectorAll('.assessment-required');
            assessmentRequiredTabs.forEach(tab => {
                tab.style.display = 'none';
            });
        }

        function renderDashboard() {
            if (!AppState.dashboardData) return;

            const dashboardSection = document.getElementById('dashboard');
            dashboardSection.innerHTML = `
                <div class="container">
                    <h2 class="section-title">Your AI-Powered Career Dashboard</h2>
                    <div class="features-grid">
                        <div class="feature-card">
                            <h3>Top Career Matches</h3>
                            <div style="margin: 1rem 0;">
                                ${AppState.dashboardData.top_matches?.map(match => `
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem; cursor: pointer;" 
                                         onclick="generateCareerPathway('${match.career}')">
                                        <span>${match.career}</span>
                                        <span>${match.match_percentage}</span>
                                    </div>
                                    <div class="progress-bar" style="margin-bottom: 1rem;">
                                        <div class="progress-fill" style="width: ${match.match_percentage}"></div>
                                    </div>
                                `).join('') || '<p>No matches found</p>'}
                            </div>
                        </div>
                        <div class="feature-card">
                            <h3>Skill Development Plan</h3>
                            <p style="color: var(--text-secondary); margin-bottom: 1rem;">Recommended skills to enhance your profile:</p>
                            <ul style="list-style: none; padding: 0;">
                                ${AppState.dashboardData.skill_development?.map(skill => `
                                    <li style="padding: 0.5rem 0; border-bottom: 1px solid var(--border);">
                                        <strong>${skill.skill}</strong> - ${skill.recommendation}
                                    </li>
                                `).join('') || '<li>No recommendations available</li>'}
                            </ul>
                        </div>
                        <div class="feature-card">
                            <h3>Market Insights</h3>
                            <p style="color: var(--text-secondary); margin-bottom: 1rem;">Current market trends in your field:</p>
                            ${AppState.dashboardData.market_insights ? `
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <span>Job Growth</span>
                                    <span style="color: var(--accent);">${AppState.dashboardData.market_insights.job_growth_percentage}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                    <span>Avg. Salary</span>
                                    <span>${AppState.dashboardData.market_insights.avg_fresher_salary}</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Remote Jobs</span>
                                    <span style="color: var(--accent);">${AppState.dashboardData.market_insights.remote_jobs_percentage}</span>
                                </div>
                            ` : '<p>No market data available</p>'}
                        </div>
                    </div>
                    <div style="text-align: center; margin-top: 2rem;">
                        <button class="btn btn-primary" onclick="generateAIResume()">Generate Resume with AI</button>
                        <button class="btn btn-secondary" onclick="showSection('discovery')" style="margin-left: 1rem;">Explore More Careers</button>
                    </div>
                </div>
            `;
        }

        // Career Discovery Functions
        async function loadCareerCards() {
            console.log('Loading career cards...', AppState.assessmentData);
            console.log('Experience value:', AppState.assessmentData.experience);
            console.log('Full AppState:', AppState);

            const careerStack = document.getElementById('career-stack');
            const noAssessmentMsg = document.getElementById('no-assessment-message');
            const loadingMsg = document.getElementById('loading-message');
            const discoveryStats = document.getElementById('discovery-stats');
            const careerActions = document.getElementById('career-actions');

            // Check if assessment is completed - more thorough check
            const hasExperience = AppState.assessmentData.experience && AppState.assessmentData.experience.trim() !== '';
            const hasEducation = AppState.assessmentData.education && AppState.assessmentData.education.trim() !== '';
            const hasInterestField = AppState.assessmentData.interestField && AppState.assessmentData.interestField.trim() !== '';
            
            console.log('Assessment checks:', { hasExperience, hasEducation, hasInterestField });
            
            if (!hasExperience || !hasEducation || !hasInterestField) {
                console.log('Assessment incomplete, showing message');
                noAssessmentMsg.style.display = 'block';
                loadingMsg.style.display = 'none';
                discoveryStats.style.display = 'none';
                careerActions.style.display = 'none';
                return;
            }

            console.log('Assessment complete, loading careers...');
            // Show loading state
            noAssessmentMsg.style.display = 'none';
            loadingMsg.style.display = 'block';
            discoveryStats.style.display = 'none';
            careerActions.style.display = 'none';

            try {
                const careers = await callAPI('/api/career-cards', AppState.assessmentData, 'POST');
                console.log('Received careers:', careers);
                
                if (careers && Array.isArray(careers) && careers.length > 0) {
                    AppState.careerCards = careers;
                    AppState.currentCardIndex = 0;
                    AppState.likedCareers = [];
                    AppState.rejectedCareers = [];
                    
                    loadingMsg.style.display = 'none';
                    discoveryStats.style.display = 'flex';
                    careerActions.style.display = 'flex';
                    
                    renderCareerCards();
                    updateDiscoveryStats();
                } else {
                    throw new Error('No career cards received');
                }
            } catch (error) {
                console.error('Failed to load career cards:', error);
                careerStack.innerHTML = `
                    <div style="text-align: center; color: var(--text-secondary); padding: 2rem;">
                        <p>Failed to load careers. Please try again later.</p>
                        <button class="btn btn-primary" onclick="loadCareerCards()" style="margin-top: 1rem;">Retry</button>
                    </div>
                `;
                loadingMsg.style.display = 'none';
                discoveryStats.style.display = 'none';
                careerActions.style.display = 'none';
            }
        }

        function renderCareerCards() {
            const stack = document.getElementById('career-stack');
            if (!AppState.careerCards || AppState.careerCards.length === 0) {
                return;
            }

            // Clear existing cards but keep other elements
            const existingCards = stack.querySelectorAll('.career-card');
            existingCards.forEach(card => card.remove());

            // Render current and next card
            for (let i = AppState.currentCardIndex; i < Math.min(AppState.currentCardIndex + 2, AppState.careerCards.length); i++) {
                const career = AppState.careerCards[i];
                const card = document.createElement('div');
                card.className = 'career-card';
                
                if (i === AppState.currentCardIndex) {
                    card.style.zIndex = '10';
                    card.style.transform = 'scale(1)';
                } else {
                    card.style.zIndex = '5';
                    card.style.transform = 'scale(0.95) translateY(10px)';
                    card.style.opacity = '0.7';
                }

                card.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem;">
                        <h3 style="margin: 0; color: var(--text-primary); font-size: 1.5rem;">${career.title}</h3>
                        <span style="background: var(--accent); color: white; padding: 0.25rem 0.75rem; border-radius: 1rem; font-size: 0.8rem; font-weight: 600;">
                            ${career.job_market_demand || 'Unknown'}
                        </span>
                    </div>
                    
                    <p style="color: var(--text-secondary); line-height: 1.6; margin-bottom: 1.5rem;">
                        ${career.description}
                    </p>
                    
                    <div style="margin-bottom: 1.5rem;">
                        <h4 style="color: var(--text-primary); margin-bottom: 0.5rem; font-size: 1rem;">Required Skills:</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                            ${(career.required_skills || []).map(skill => 
                                `<span style="background: var(--bg-tertiary); border: 1px solid var(--border); color: var(--text-primary); padding: 0.25rem 0.75rem; border-radius: 1rem; font-size: 0.85rem;">
                                    ${skill}
                                </span>`
                            ).join('')}
                        </div>
                    </div>
                    
                    ${career.interests && career.interests.length > 0 ? `
                        <div>
                            <h4 style="color: var(--text-primary); margin-bottom: 0.5rem; font-size: 1rem;">Related Interests:</h4>
                            <div style="display: flex; flex-wrap: wrap; gap: 0.5rem;">
                                ${career.interests.map(interest => 
                                    `<span style="background: rgba(52, 211, 153, 0.2); color: var(--accent); padding: 0.25rem 0.75rem; border-radius: 1rem; font-size: 0.85rem;">
                                        ${interest}
                                    </span>`
                                ).join('')}
                            </div>
                        </div>
                    ` : ''}
                `;

                stack.appendChild(card);
            }
            
            // Ensure action buttons are visible when cards are rendered
            const careerActions = document.getElementById('career-actions');
            if (careerActions) {
                careerActions.style.display = 'flex';
                console.log('Career actions buttons should now be visible');
            }
        }

        function updateDiscoveryStats() {
            document.getElementById('liked-count').textContent = AppState.likedCareers.length;
            document.getElementById('remaining-count').textContent = Math.max(0, AppState.careerCards.length - AppState.currentCardIndex);
            document.getElementById('passed-count').textContent = AppState.rejectedCareers.length;
        }

        function swipeCard(direction) {
            if (!AppState.careerCards || AppState.currentCardIndex >= AppState.careerCards.length) {
                return;
            }

            const currentCard = AppState.careerCards[AppState.currentCardIndex];

            // Add visual feedback
            const card = document.querySelector('.career-card');
            if (card) {
                card.style.transition = 'transform 0.3s ease, opacity 0.3s ease';
                if (direction === 'like') {
                    card.style.transform = 'translateX(100%) rotate(20deg)';
                    AppState.likedCareers.push(currentCard);
                } else {
                    card.style.transform = 'translateX(-100%) rotate(-20deg)';
                    AppState.rejectedCareers.push(currentCard);
                }
                card.style.opacity = '0';
            }

            AppState.currentCardIndex++;

            // Remove the visual feedback after animation and render next card
            setTimeout(() => {
                if (AppState.currentCardIndex >= AppState.careerCards.length) {
                    showDiscoveryComplete();
                } else {
                    renderCareerCards();
                    updateDiscoveryStats();
                }
            }, 300);
        }

        function showDiscoveryComplete() {
            const careerStack = document.getElementById('career-stack');
            const discoveryStats = document.getElementById('discovery-stats');
            const careerActions = document.getElementById('career-actions');

            discoveryStats.style.display = 'none';
            careerActions.style.display = 'none';

            if (AppState.likedCareers.length === 0) {
                careerStack.innerHTML = `
                    <div style="text-align: center; padding: 2rem;">
                        <h3 style="color: var(--text-primary); margin-bottom: 1rem;">No careers liked!</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                            Try exploring more career options or retake the assessment with different answers.
                        </p>
                        <button class="btn btn-primary" onclick="resetDiscovery()" style="margin-top: 1rem;">Try Again</button>
                    </div>
                `;
                return;
            }

            // Analyze swipe results
            analyzeSwipeResults();
        }

        async function analyzeSwipeResults() {
            const careerStack = document.getElementById('career-stack');
            
            try {
                const results = await callAPI('/api/swipe-results', {
                    likedCareers: AppState.likedCareers,
                    dislikedCareers: AppState.rejectedCareers,
                    assessment: AppState.assessmentData
                }, 'POST');

                careerStack.innerHTML = `
                    <div style="text-align: center; padding: 2rem;">
                        <h3 style="color: var(--text-primary); margin-bottom: 1rem;">🎉 Discovery Complete!</h3>
                        <p style="color: var(--text-secondary); margin: 1rem 0; line-height: 1.6;">
                            ${results.insights || 'Based on your preferences, we have some great insights for you!'}
                        </p>
                        
                        <div style="margin: 1.5rem 0; background: var(--bg-tertiary); padding: 1.5rem; border-radius: 12px;">
                            <h4 style="color: var(--text-primary); margin-bottom: 1rem;">Careers You Liked:</h4>
                            <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; justify-content: center;">
                                ${AppState.likedCareers.map(career => `
                                    <span style="background: var(--accent); color: white; padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.9rem;">
                                        ${career.title}
                                    </span>
                                `).join('')}
                            </div>
                        </div>

                        ${results.recommended_skills ? `
                            <div style="margin: 1.5rem 0; background: var(--bg-secondary); padding: 1.5rem; border-radius: 12px;">
                                <h4 style="color: var(--text-primary); margin-bottom: 1rem;">Recommended Skills to Develop:</h4>
                                <div style="display: flex; flex-wrap: wrap; gap: 0.5rem; justify-content: center;">
                                    ${results.recommended_skills.map(skill => `
                                        <span style="background: var(--border); color: var(--text-primary); padding: 0.5rem 1rem; border-radius: 20px; font-size: 0.9rem;">
                                            ${skill}
                                        </span>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}

                        <div style="margin-top: 2rem;">
                            <button class="btn btn-primary" onclick="showSection('pathway')" style="margin-right: 1rem;">
                                View Career Pathway
                            </button>
                            <button class="btn btn-secondary" onclick="resetDiscovery()">
                                Discover More
                            </button>
                        </div>
                    </div>
                `;
            } catch (error) {
                console.error('Failed to analyze swipe results:', error);
                careerStack.innerHTML = `
                    <div style="text-align: center; padding: 2rem;">
                        <h3 style="color: var(--text-primary); margin-bottom: 1rem;">Discovery Complete!</h3>
                        <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                            You've completed the career discovery! Based on your selections, you can now explore career pathways.
                        </p>
                        <div style="margin: 1.5rem 0;">
                            <h4 style="color: var(--text-primary); margin-bottom: 1rem;">Careers You Liked:</h4>
                            ${AppState.likedCareers.map(career => `
                                <div style="background: var(--bg-tertiary); padding: 0.75rem; margin: 0.5rem 0; border-radius: 8px; color: var(--text-primary);">
                                    ${career.title}
                                </div>
                            `).join('')}
                        </div>
                        <div style="margin-top: 2rem;">
                            <button class="btn btn-primary" onclick="showSection('pathway')" style="margin-right: 1rem;">
                                View Career Pathway
                            </button>
                            <button class="btn btn-secondary" onclick="resetDiscovery()">
                                Try Again
                            </button>
                        </div>
                    </div>
                `;
            }
        }

        function resetDiscovery() {
            AppState.currentCardIndex = 0;
            AppState.likedCareers = [];
            AppState.rejectedCareers = [];
            loadCareerCards();
        }

        // Chat Functions
        let chatMessages, chatInput, sendBtn;

        function initChatElements() {
            chatMessages = document.getElementById('chat-messages');
            chatInput = document.getElementById('chat-input');
            sendBtn = document.getElementById('send-btn');

            if (sendBtn && chatInput) {
                sendBtn.addEventListener('click', sendMessage);
                chatInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        sendMessage();
                    }
                });
            }
        }

        function addMessage(content, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : ''}`;

            messageDiv.innerHTML = `
                <div class="message-avatar">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="white">
                        ${isUser ?
                    '<path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>' :
                    '<path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>'
                }
                    </svg>
                </div>
                <div class="message-content">${content}</div>
            `;

            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showTypingIndicator() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message typing-message';
            typingDiv.innerHTML = `
                <div class="message-avatar">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="white">
                        <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"/>
                    </svg>
                </div>
                <div class="message-content">
                    <div class="typing-indicator">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            `;
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            return typingDiv;
        }

        async function sendMessage() {
            const message = chatInput.value.trim();
            if (!message) return;

            addMessage(message, true);
            chatInput.value = '';

            const typingIndicator = showTypingIndicator();

            try {
                const response = await callAPI('/api/chat', { message }, 'POST');
                typingIndicator.remove();
                addMessage(response.response);
            } catch (error) {
                typingIndicator.remove();
                addMessage('Sorry, I\'m having trouble connecting right now. Please try again later.');
                console.error('Chat error:', error);
            }
        }

        // Chat event listeners are now handled in initChatElements()

        // Resume Builder Functions
        async function generateAIResume() {
            if (!AppState.assessmentData.experience) {
                alert('Please complete the assessment first!');
                showSection('assessment');
                return;
            }

            AppState.isLoading = true;
            try {
                // Get personal info from form if available
                const personalInfo = {
                    name: document.getElementById('resume-name')?.value || AppState.resumeData.personal_info?.name || '',
                    email: document.getElementById('resume-email')?.value || AppState.resumeData.personal_info?.email || '',
                    phone: document.getElementById('resume-phone')?.value || AppState.resumeData.personal_info?.phone || '',
                    location: document.getElementById('resume-location')?.value || AppState.resumeData.personal_info?.location || 'India',
                    linkedin: document.getElementById('resume-linkedin')?.value || AppState.resumeData.personal_info?.linkedin || '',
                    github: document.getElementById('resume-github')?.value || AppState.resumeData.personal_info?.github || ''
                };

                const requestData = {
                    assessment: AppState.assessmentData,
                    personalInfo: personalInfo
                };

                const result = await callAPI('/api/generate-resume', requestData, 'POST');

                // Update resume data with AI generated content
                AppState.resumeData = result;

                showSection('resume');
                renderResumeBuilder();
            } catch (error) {
                alert('Failed to generate resume. Please try again.');
                console.error('Resume generation error:', error);
            } finally {
                AppState.isLoading = false;
            }
        }

        function generateResumeFromLikes() {
            if (AppState.likedCareers.length === 0) {
                alert('Please like some careers first!');
                return;
            }

            // Update assessment data based on liked careers
            AppState.assessmentData.interestField = AppState.likedCareers[0].title;
            AppState.assessmentData.goals = `To pursue a career as a ${AppState.likedCareers[0].title} or in a similar role.`;

            generateAIResume();
        }

        function renderResumeBuilder() {
            const resumeSection = document.getElementById('resume');
            resumeSection.innerHTML = `
                <div class="container">
                    <h2 class="section-title">AI Resume Builder</h2>
                    <div class="resume-builder">
                        <div class="resume-form">
                            <h3 style="margin-bottom: 1.5rem;">Build Your Resume</h3>
                            
                            <div class="form-group">
                                <label class="form-label">Full Name</label>
                                <input type="text" class="form-input" id="resume-name" placeholder="John Doe Smith" 
                                       value="${AppState.resumeData.personal_info.name}">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-input" id="resume-email" placeholder="john.smith.example@gmail.com"
                                       value="${AppState.resumeData.personal_info.email}">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Phone</label>
                                <input type="tel" class="form-input" id="resume-phone" placeholder="+91-9876543210"
                                       value="${AppState.resumeData.personal_info.phone}">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Location</label>
                                <input type="text" class="form-input" id="resume-location" placeholder="Karnataka, India"
                                       value="${AppState.resumeData.personal_info.location || 'Karnataka, India'}">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">LinkedIn Profile</label>
                                <input type="url" class="form-input" id="resume-linkedin" placeholder="https://www.linkedin.com/in/john-smith-example"
                                       value="${AppState.resumeData.personal_info.linkedin || ''}">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">GitHub Profile</label>
                                <input type="url" class="form-input" id="resume-github" placeholder="https://github.com/johnsmith-example"
                                       value="${AppState.resumeData.personal_info.github || ''}">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Professional Summary</label>
                                <textarea class="form-input" id="resume-summary" rows="4" 
                                          placeholder="A motivated and detail-oriented third-year Computer Science Engineering student with strong academic background and hands-on project experience. Seeking to apply theoretical knowledge and practical skills in a challenging software development role.">${AppState.resumeData.summary}</textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Skills</label>
                                <textarea class="form-input" id="resume-skills" rows="3"
                                          placeholder="Java, Python, JavaScript, C++, HTML, CSS">${AppState.resumeData.skills.programming_languages?.join(', ') || ''}</textarea>
                            </div>

                            <!-- Dynamic Education Entries -->
                            <div class="form-group">
                                <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:0.5rem;">
                                    <label class="form-label" style="margin:0;">Education</label>
                                    <button type="button" class="btn btn-secondary" id="add-education-btn" style="padding:0.5rem 0.75rem; font-size:0.9rem;">+ Add Education</button>
                                </div>
                                <div id="education-entries"></div>
                            </div>

                            <!-- Dynamic Projects Entries -->
                            <div class="form-group">
                                <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:0.5rem;">
                                    <label class="form-label" style="margin:0;">Academic Projects</label>
                                    <button type="button" class="btn btn-secondary" id="add-project-btn" style="padding:0.5rem 0.75rem; font-size:0.9rem;">+ Add Project</button>
                                </div>
                                <div id="project-entries"></div>
                            </div>

                            <!-- Dynamic Achievements Entries -->
                            <div class="form-group">
                                <div style="display:flex; align-items:center; justify-content:space-between; margin-bottom:0.5rem;">
                                    <label class="form-label" style="margin:0;">Achievements / Certifications</label>
                                    <button type="button" class="btn btn-secondary" id="add-achievement-btn" style="padding:0.5rem 0.75rem; font-size:0.9rem;">+ Add Achievement</button>
                                </div>
                                <div id="achievement-entries"></div>
                            </div>
                            
                            <div style="display: flex; gap: 1rem;">
                                <button class="btn btn-primary" onclick="generateAIResume()" style="flex: 1;">
                                    Regenerate with AI
                                </button>
                                <button class="btn btn-secondary" onclick="downloadResumePDF()" style="flex: 1;">
                                    Download PDF
                                </button>
                            </div>
                        </div>
                        
                        <div class="resume-preview">
                            <!-- Preview Controls -->
                            <div class="preview-controls">
                                <button class="preview-control-btn" onclick="zoomOut()" title="Zoom Out">-</button>
                                <span class="scale-indicator" id="scale-indicator">${Math.round(AppState.resumeScale * 100)}%</span>
                                <button class="preview-control-btn" onclick="zoomIn()" title="Zoom In">+</button>
                                <button class="preview-control-btn" onclick="resetZoom()" title="Reset Zoom" style="font-size: 12px; margin-left: 0.5rem;">↻</button>
                            </div>
                            
                            <div id="resume-preview-content" class="preview-zoom" style="background: white; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); font-family: 'Times New Roman', serif; line-height: 1.5; color: #000; width: 210mm; min-height: 297mm; margin: 0 auto; padding: 15mm; transform: scale(${AppState.resumeScale}); transform-origin: top center;">
                                
                                <!-- Header Section -->
                                <div style="text-align: center; margin-bottom: 2rem;">
                                    <h1 style="font-size: 1.8rem; font-weight: bold; margin: 0 0 0.5rem 0; color: #000;">${AppState.resumeData.personal_info?.name || 'Your Name'}</h1>
                                    <div style="font-size: 0.95rem; color: #000; margin-bottom: 0.25rem;">
                                        ${AppState.resumeData.personal_info?.phone || '+91 98765 43210'}
                                    </div>
                                    <div style="font-size: 0.95rem; color: #000; margin-bottom: 0.25rem;">
                                        Email: ${AppState.resumeData.personal_info?.email || 'your.email@example.com'}
                                    </div>
                                    ${AppState.resumeData.personal_info?.linkedin || AppState.resumeData.personal_info?.github ? `
                                        <div style="font-size: 0.95rem; color: #4285f4; margin-bottom: 0.25rem;">
                                            ${AppState.resumeData.personal_info?.linkedin ? `<span style="text-decoration: underline;">${AppState.resumeData.personal_info.linkedin}</span>` : ''}
                                            ${AppState.resumeData.personal_info?.linkedin && AppState.resumeData.personal_info?.github ? ' | ' : ''}
                                            ${AppState.resumeData.personal_info?.github ? `<span style="text-decoration: underline;">${AppState.resumeData.personal_info.github}</span>` : ''}
                                        </div>
                                    ` : ''}
                                    <div style="font-size: 0.95rem; color: #000;">
                                        ${AppState.resumeData.personal_info?.location || 'Karnataka, India'}
                                    </div>
                                </div>
                                
                                <!-- Objective/Summary Section -->
                                <div style="margin-bottom: 1.5rem;">
                                    <h2 style="font-size: 1.1rem; font-weight: bold; margin: 0 0 0.5rem 0; color: #000; border-bottom: 1px solid #000; padding-bottom: 2px;">Objective</h2>
                                    <p style="margin: 0; font-size: 0.95rem; text-align: justify; color: #000; line-height: 1.4;">${AppState.resumeData.summary || 'A motivated and detail-oriented professional seeking to apply theoretical knowledge and practical skills in a challenging role.'}</p>
                                </div>
                                
                                <!-- Education Section -->
                                ${AppState.resumeData.education?.length ? `
                                    <div style="margin-bottom: 1.5rem;">
                                        <h2 style="font-size: 1.1rem; font-weight: bold; margin: 0 0 0.5rem 0; color: #000; border-bottom: 1px solid #000; padding-bottom: 2px;">Education</h2>
                                        ${AppState.resumeData.education.map(edu => `
                                            <div style="margin-bottom: 1rem;">
                                                <div style="display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 0.25rem;">
                                                    <h3 style="font-size: 1rem; font-weight: bold; margin: 0; color: #000;">${edu.degree}</h3>
                                                    <span style="font-size: 0.95rem; color: #000; font-weight: bold;">${edu.dates}</span>
                                                </div>
                                                <div style="font-size: 0.95rem; color: #000; font-style: italic; margin-bottom: 0.25rem;">${edu.institution}, ${edu.location}</div>
                                                ${edu.details ? `<div style="font-size: 0.9rem; color: #000; margin-left: 1rem;">${edu.details}</div>` : ''}
                                            </div>
                                        `).join('')}
                                    </div>
                                ` : ''}
                                
                                <!-- Experience Section -->
                                ${AppState.resumeData.experience?.length ? `
                                    <div style="margin-bottom: 1.5rem;">
                                        <h2 style="font-size: 1.1rem; font-weight: bold; margin: 0 0 0.5rem 0; color: #000; border-bottom: 1px solid #000; padding-bottom: 2px;">Experience</h2>
                                        ${AppState.resumeData.experience.map(exp => `
                                            <div style="margin-bottom: 1rem;">
                                                <div style="display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 0.25rem;">
                                                    <h3 style="font-size: 1rem; font-weight: bold; margin: 0; color: #000;">${exp.title}</h3>
                                                    <span style="font-size: 0.95rem; color: #000; font-weight: bold;">${exp.dates}</span>
                                                </div>
                                                <div style="font-size: 0.95rem; color: #000; font-style: italic; margin-bottom: 0.5rem;">${exp.company}, ${exp.location}</div>
                                                <div style="font-size: 0.9rem; color: #000; margin-left: 1rem;">
                                                    ${exp.description.split('.').filter(sentence => sentence.trim()).map(sentence =>
                `<div style="margin-bottom: 0.25rem;">– ${sentence.trim()}${sentence.trim().endsWith('.') ? '' : '.'}</div>`
            ).join('')}
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                ` : ''}
                                
                                <!-- Projects Section -->
                                ${AppState.resumeData.projects?.length ? `
                                    <div style="margin-bottom: 1.5rem;">
                                        <h2 style="font-size: 1.1rem; font-weight: bold; margin: 0 0 0.5rem 0; color: #000; border-bottom: 1px solid #000; padding-bottom: 2px;">Academic Projects</h2>
                                        ${AppState.resumeData.projects.map(project => `
                                            <div style="margin-bottom: 1rem;">
                                                <h3 style="font-size: 1rem; font-weight: bold; margin: 0 0 0.25rem 0; color: #000;">${project.name}</h3>
                                                <p style="margin: 0 0 0.25rem 1rem; font-size: 0.9rem; color: #000; text-align: justify; line-height: 1.4;">${project.description}</p>
                                            </div>
                                        `).join('')}
                                    </div>
                                ` : ''}
                                
                                <!-- Skills Section -->
                                <div style="margin-bottom: 1.5rem;">
                                    <h2 style="font-size: 1.1rem; font-weight: bold; margin: 0 0 0.5rem 0; color: #000; border-bottom: 1px solid #000; padding-bottom: 2px;">Skills</h2>
                                    ${AppState.resumeData.skills?.programming_languages?.length ? `
                                        <div style="margin-bottom: 0.5rem;">
                                            <span style="font-weight: bold; color: #000;">• Programming: </span>
                                            <span style="color: #000; font-size: 0.95rem;">${AppState.resumeData.skills.programming_languages.join(', ')}</span>
                                        </div>
                                    ` : ''}
                                    ${AppState.resumeData.skills?.developer_tools?.length ? `
                                        <div style="margin-bottom: 0.5rem;">
                                            <span style="font-weight: bold; color: #000;">• Software: </span>
                                            <span style="color: #000; font-size: 0.95rem;">${AppState.resumeData.skills.developer_tools.join(', ')}</span>
                                        </div>
                                    ` : ''}
                                    ${AppState.resumeData.skills?.frameworks?.length ? `
                                        <div style="margin-bottom: 0.5rem;">
                                            <span style="font-weight: bold; color: #000;">• Frameworks: </span>
                                            <span style="color: #000; font-size: 0.95rem;">${AppState.resumeData.skills.frameworks.join(', ')}</span>
                                        </div>
                                    ` : ''}
                                    ${AppState.resumeData.skills?.soft_skills?.length ? `
                                        <div style="margin-bottom: 0.5rem;">
                                            <span style="font-weight: bold; color: #000;">• Core Competencies: </span>
                                            <span style="color: #000; font-size: 0.95rem;">${AppState.resumeData.skills.soft_skills.join(', ')}</span>
                                        </div>
                                    ` : ''}
                                </div>
                                
                                <!-- Achievements Section -->
                                ${AppState.resumeData.certifications?.length ? `
                                    <div style="margin-bottom: 1.5rem;">
                                        <h2 style="font-size: 1.1rem; font-weight: bold; margin: 0 0 0.5rem 0; color: #000; border-bottom: 1px solid #000; padding-bottom: 2px;">Achievements & Participation</h2>
                                        ${AppState.resumeData.certifications.map(cert => `
                                            <div style="margin-bottom: 0.5rem; color: #000; font-size: 0.95rem;">
                                                • ${cert.name} - ${cert.issuer} (${cert.date})
                                            </div>
                                        `).join('')}
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                </div>
            `;

            // Wire basic input listeners immediately
            const inputs = ['resume-name', 'resume-email', 'resume-phone', 'resume-location', 'resume-linkedin', 'resume-github', 'resume-summary', 'resume-skills'];
            inputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', updateResumePreview);
                }
            });

            // Render dynamic sections and attach handlers
            renderEducationForms();
            renderProjectForms();
            renderAchievementForms();

            const addEdu = document.getElementById('add-education-btn');
            if (addEdu) addEdu.addEventListener('click', () => { addEducationEntry(); });
            const addProj = document.getElementById('add-project-btn');
            if (addProj) addProj.addEventListener('click', () => { addProjectEntry(); });
            const addAch = document.getElementById('add-achievement-btn');
            if (addAch) addAch.addEventListener('click', () => { addAchievementEntry(); });

            // Ensure the LaTeX-style preview is shown immediately
            updateResumePreview();

            // Fit preview to container after everything is ready
            setTimeout(() => {
                fitResumePreview();
                applyManualScale(); // Initialize control states
            }, 500);
        }

        // ----- Dynamic Resume Form Helpers -----
        function ensureResumeArrays() {
            if (!AppState.resumeData) AppState.resumeData = {};
            if (!AppState.resumeData.personal_info) AppState.resumeData.personal_info = {};
            if (!AppState.resumeData.education) AppState.resumeData.education = [];
            if (!AppState.resumeData.projects) AppState.resumeData.projects = [];
            if (!AppState.resumeData.certifications) AppState.resumeData.certifications = [];
            if (!AppState.resumeData.skills) AppState.resumeData.skills = {};
            if (!AppState.resumeData.skills.programming_languages) AppState.resumeData.skills.programming_languages = [];
        }

        function renderEducationForms() {
            ensureResumeArrays();
            const container = document.getElementById('education-entries');
            if (!container) return;
            container.innerHTML = AppState.resumeData.education.map((edu, idx) => `
                <div class="education-entry-form" data-index="${idx}" style="border:1px solid var(--border); border-radius:8px; padding:0.75rem; margin-bottom:0.75rem;">
                    <div style="display:flex; gap:0.5rem;">
                        <input class="form-input" data-section="education" data-field="degree" data-index="${idx}" placeholder="Degree (e.g., B.E. CSE)" value="${edu.degree || ''}" style="flex:1;" />
                        <input class="form-input" data-section="education" data-field="dates" data-index="${idx}" placeholder="Years (e.g., 2022 -- Present)" value="${edu.dates || ''}" style="flex:1;" />
                    </div>
                    <div style="display:flex; gap:0.5rem; margin-top:0.5rem;">
                        <input class="form-input" data-section="education" data-field="institution" data-index="${idx}" placeholder="Institution" value="${edu.institution || ''}" style="flex:1;" />
                        <input class="form-input" data-section="education" data-field="location" data-index="${idx}" placeholder="Location" value="${edu.location || ''}" style="flex:1;" />
                    </div>
                    <div style="display:flex; gap:0.5rem; margin-top:0.5rem;">
                        <input class="form-input" data-section="education" data-field="gpa" data-index="${idx}" placeholder="CGPA / Percentage" value="${edu.gpa || edu.percentage || ''}" style="flex:1;" />
                    </div>
                    <div style="margin-top:0.5rem;">
                        <textarea class="form-input" data-section="education" data-field="coursework" data-index="${idx}" rows="2" placeholder="Relevant Coursework (comma-separated)">${edu.coursework || ''}</textarea>
                    </div>
                    <div style="text-align:right; margin-top:0.5rem;">
                        <button type="button" class="btn btn-secondary" data-action="remove-education" data-index="${idx}" style="padding:0.4rem 0.6rem; font-size:0.85rem;">Remove</button>
                    </div>
                </div>
            `).join('');

            container.removeEventListener('input', handleDynamicResumeInput);
            container.addEventListener('input', handleDynamicResumeInput);
            container.removeEventListener('click', handleDynamicResumeClick);
            container.addEventListener('click', handleDynamicResumeClick);
        }

        function renderProjectForms() {
            ensureResumeArrays();
            const container = document.getElementById('project-entries');
            if (!container) return;
            container.innerHTML = AppState.resumeData.projects.map((proj, idx) => `
                <div class="project-entry-form" data-index="${idx}" style="border:1px solid var(--border); border-radius:8px; padding:0.75rem; margin-bottom:0.75rem;">
                    <input class="form-input" data-section="projects" data-field="name" data-index="${idx}" placeholder="Project Name" value="${proj.name || ''}" />
                    <textarea class="form-input" data-section="projects" data-field="description" data-index="${idx}" rows="2" placeholder="Project Description">${proj.description || ''}</textarea>
                    <div style="text-align:right; margin-top:0.5rem;">
                        <button type="button" class="btn btn-secondary" data-action="remove-project" data-index="${idx}" style="padding:0.4rem 0.6rem; font-size:0.85rem;">Remove</button>
                    </div>
                </div>
            `).join('');

            container.removeEventListener('input', handleDynamicResumeInput);
            container.addEventListener('input', handleDynamicResumeInput);
            container.removeEventListener('click', handleDynamicResumeClick);
            container.addEventListener('click', handleDynamicResumeClick);
        }

        function renderAchievementForms() {
            ensureResumeArrays();
            const container = document.getElementById('achievement-entries');
            if (!container) return;
            container.innerHTML = AppState.resumeData.certifications.map((ach, idx) => `
                <div class="achievement-entry-form" data-index="${idx}" style="border:1px solid var(--border); border-radius:8px; padding:0.75rem; margin-bottom:0.75rem;">
                    <div style="display:flex; gap:0.5rem;">
                        <input class="form-input" data-section="certifications" data-field="name" data-index="${idx}" placeholder="Achievement / Certification" value="${ach.name || ''}" style="flex:1;" />
                    </div>
                    <div style="display:flex; gap:0.5rem; margin-top:0.5rem;">
                        <input class="form-input" data-section="certifications" data-field="issuer" data-index="${idx}" placeholder="Issuer / Organization" value="${ach.issuer || ''}" style="flex:1;" />
                        <input class="form-input" data-section="certifications" data-field="date" data-index="${idx}" placeholder="Year / Date" value="${ach.date || ''}" style="flex:1;" />
                    </div>
                    <div style="text-align:right; margin-top:0.5rem;">
                        <button type="button" class="btn btn-secondary" data-action="remove-achievement" data-index="${idx}" style="padding:0.4rem 0.6rem; font-size:0.85rem;">Remove</button>
                    </div>
                </div>
            `).join('');

            container.removeEventListener('input', handleDynamicResumeInput);
            container.addEventListener('input', handleDynamicResumeInput);
            container.removeEventListener('click', handleDynamicResumeClick);
            container.addEventListener('click', handleDynamicResumeClick);
        }

        function handleDynamicResumeInput(e) {
            const target = e.target;
            const section = target.getAttribute('data-section');
            const field = target.getAttribute('data-field');
            const index = parseInt(target.getAttribute('data-index'));
            if (!section || field == null || isNaN(index)) return;
            ensureResumeArrays();
            if (section === 'education') {
                const edu = AppState.resumeData.education[index] || {};
                edu[field] = target.value;
                AppState.resumeData.education[index] = edu;
            } else if (section === 'projects') {
                const proj = AppState.resumeData.projects[index] || {};
                proj[field] = target.value;
                AppState.resumeData.projects[index] = proj;
            } else if (section === 'certifications') {
                const ach = AppState.resumeData.certifications[index] || {};
                ach[field] = target.value;
                AppState.resumeData.certifications[index] = ach;
            }
            updateResumePreview();
        }

        function handleDynamicResumeClick(e) {
            const btn = e.target.closest('button');
            if (!btn) return;
            const action = btn.getAttribute('data-action');
            const index = parseInt(btn.getAttribute('data-index'));
            if (!action || isNaN(index)) return;
            ensureResumeArrays();
            if (action === 'remove-education') {
                AppState.resumeData.education.splice(index, 1);
                renderEducationForms();
            } else if (action === 'remove-project') {
                AppState.resumeData.projects.splice(index, 1);
                renderProjectForms();
            } else if (action === 'remove-achievement') {
                AppState.resumeData.certifications.splice(index, 1);
                renderAchievementForms();
            }
            updateResumePreview();
            // Only refit when structure changes significantly
            fitResumePreview();
        }

        function addEducationEntry() {
            ensureResumeArrays();
            AppState.resumeData.education.push({ degree: '', dates: '', institution: '', location: '', gpa: '', coursework: '' });
            renderEducationForms();
            updateResumePreview();
            fitResumePreview();
        }

        function addProjectEntry() {
            ensureResumeArrays();
            AppState.resumeData.projects.push({ name: '', description: '' });
            renderProjectForms();
            updateResumePreview();
            fitResumePreview();
        }

        function addAchievementEntry() {
            ensureResumeArrays();
            AppState.resumeData.certifications.push({ name: '', issuer: '', date: '' });
            renderAchievementForms();
            updateResumePreview();
            fitResumePreview();
        }

        function updateResumePreview() {
            const name = document.getElementById('resume-name')?.value || 'John Doe Smith';
            const email = document.getElementById('resume-email')?.value || 'john.smith.example@gmail.com';
            const phone = document.getElementById('resume-phone')?.value || '+91-9876543210';
            const location = document.getElementById('resume-location')?.value || 'Karnataka, India';
            const linkedin = document.getElementById('resume-linkedin')?.value || 'https://www.linkedin.com/in/john-smith-example';
            const github = document.getElementById('resume-github')?.value || 'https://github.com/johnsmith-example';
            const summary = document.getElementById('resume-summary')?.value || 'A motivated and detail-oriented third-year Computer Science Engineering student with strong academic background and hands-on project experience. Seeking to apply theoretical knowledge and practical skills in a challenging software development role.';
            const skills = document.getElementById('resume-skills')?.value || 'Java, Python, JavaScript, C++, HTML, CSS';

            // Update the personal info in AppState
            AppState.resumeData.personal_info = {
                ...AppState.resumeData.personal_info,
                name, email, phone, location, linkedin, github
            };
            AppState.resumeData.summary = summary;

            // Parse skills (comma-separated) into programming_languages array so preview reflects input
            if (!AppState.resumeData.skills) AppState.resumeData.skills = {};
            const parsedSkills = (skills || '')
                .split(',')
                .map(s => s.trim())
                .filter(s => s.length > 0);
            AppState.resumeData.skills.programming_languages = parsedSkills;

            // Only update the preview content, not the entire form
            const previewContent = document.getElementById('resume-preview-content');
            if (previewContent) {
                previewContent.innerHTML = `
                    <div style="background: white; padding: 15mm; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); font-family: 'Times New Roman', serif; line-height: 1.6; color: #000; width: 210mm; min-height: 297mm; margin: 0 auto; font-size: 11pt;">
                        
                        <!-- Header Section - LaTeX Style -->
                        <div style="text-align: center; margin-bottom: 1.5rem;">
                            <h1 style="font-size: 1.5rem; font-weight: bold; margin: 0 0 0.25rem 0; color: #000;">${name}</h1>
                            <div style="font-size: 0.9rem; color: #000; margin-bottom: 0.15rem; line-height: 1.2;">
                                ${phone}
                            </div>
                            <div style="font-size: 0.9rem; color: #000; margin-bottom: 0.15rem; line-height: 1.2;">
                                Email: ${email}
                            </div>
                            ${linkedin || github ? `
                                <div style="font-size: 0.9rem; margin-bottom: 0.15rem; line-height: 1.2;">
                                    ${linkedin ? `<a href="${linkedin}" style="color: blue; text-decoration: underline;">LinkedIn</a>` : ''}
                                    ${linkedin && github ? ' | ' : ''}
                                    ${github ? `<a href="${github}" style="color: blue; text-decoration: underline;">GitHub</a>` : ''}
                                </div>
                            ` : ''}
                            <div style="font-size: 0.9rem; color: #000; line-height: 1.2;">
                                ${location}
                            </div>
                        </div>
                        
                        <!-- Objective Section -->
                        <div style="margin-bottom: 1.2rem;">
                            <h2 style="font-size: 1.1rem; font-weight: bold; margin: 0 0 0.4rem 0; color: #000; border-bottom: 1px solid #000; padding-bottom: 1px; line-height: 1.4;">Objective</h2>
                            <p style="margin: 0; font-size: 1rem; text-align: justify; color: #000; line-height: 1.6;">${summary}</p>
                        </div>
                        
                        <!-- Education Section -->
                        ${AppState.resumeData.education?.length ? `
                            <div style="margin-bottom: 1.2rem;">
                                <h2 style="font-size: 1.1rem; font-weight: bold; margin: 0 0 0.4rem 0; color: #000; border-bottom: 1px solid #000; padding-bottom: 1px; line-height: 1.4;">Education</h2>
                                ${AppState.resumeData.education.map(edu => `
                                    <div style="margin-bottom: 1rem;">
                                        <div style="display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 0.1rem;">
                                            <div style="font-weight: bold; font-size: 1rem; color: #000;">${edu.degree}</div>
                                            <div style="font-size: 1rem; color: #000; font-weight: bold;">${edu.dates}</div>
                                        </div>
                                        <div style="font-size: 1rem; color: #000; font-style: italic; margin-bottom: 0.2rem;">${edu.institution}${edu.location ? `, ${edu.location}` : ''}</div>
                                        ${edu.gpa ? `<div style="font-size: 1rem; color: #000; font-style: italic;">Current CGPA: ${edu.gpa}</div>` : ''}
                                        ${edu.coursework ? `<div style="font-size: 1rem; color: #000; margin-top: 0.2rem;"><strong>Relevant Coursework:</strong> ${edu.coursework}</div>` : ''}
                                    </div>
                                `).join('')}
                            </div>
                        ` : `
                            <div style="margin-bottom: 1.2rem;">
                                <h2 style="font-size: 1.1rem; font-weight: bold; margin: 0 0 0.4rem 0; color: #000; border-bottom: 1px solid #000; padding-bottom: 1px;">Education</h2>
                                <div style="margin-bottom: 1rem;">
                                    <div style="display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 0.1rem;">
                                        <div style="font-weight: bold; font-size: 1rem; color: #000;">Bachelor of Engineering (B.E.), Computer Science Engineering</div>
                                        <div style="font-size: 1rem; color: #000; font-weight: bold;">2022 -- Present</div>
                                    </div>
                                    <div style="font-size: 1rem; color: #000; font-style: italic; margin-bottom: 0.2rem;">ABC Institute of Technology, Bangalore</div>
                                    <div style="font-size: 1rem; color: #000; font-style: italic;">Current CGPA: 8.25</div>
                                    <div style="font-size: 1rem; color: #000; margin-top: 0.2rem;"><strong>Relevant Coursework:</strong> Data Structures and Algorithms, Object-Oriented Programming, Database Management Systems, Computer Networks, Software Engineering.</div>
                                </div>
                            </div>
                        `}
                        
                        <!-- Experience Section -->
                        ${AppState.resumeData.experience?.length ? `
                            <div style="margin-bottom: 1.2rem;">
                                <h2 style="font-size: 1.1rem; font-weight: bold; margin: 0 0 0.4rem 0; color: #000; border-bottom: 1px solid #000; padding-bottom: 1px;">Internship Experience</h2>
                                ${AppState.resumeData.experience.map(exp => `
                                    <div style="margin-bottom: 1rem;">
                                        <div style="display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 0.1rem;">
                                            <div style="font-weight: bold; font-size: 1rem; color: #000;">${exp.title}</div>
                                            <div style="font-size: 1rem; color: #000; font-weight: bold;">${exp.dates}</div>
                                        </div>
                                        <div style="font-size: 1rem; color: #000; font-style: italic; margin-bottom: 0.3rem;">${exp.company}${exp.location ? `, ${exp.location}` : ''}</div>
                                        <div style="font-size: 1rem; color: #000; line-height: 1.6;">
                                            ${exp.description.split('.').filter(sentence => sentence.trim()).map(sentence =>
                    `<div style="margin-bottom: 0.2rem;">-- ${sentence.trim()}${sentence.trim().endsWith('.') ? '' : '.'}</div>`
                ).join('')}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                        
                        <!-- Projects Section -->
                        ${AppState.resumeData.projects?.length ? `
                            <div style="margin-bottom: 1.2rem;">
                                <h2 style="font-size: 1.1rem; font-weight: bold; margin: 0 0 0.4rem 0; color: #000; border-bottom: 1px solid #000; padding-bottom: 1px;">Academic Projects</h2>
                                ${AppState.resumeData.projects.map(project => `
                                    <div style="margin-bottom: 0.8rem;">
                                        <div style="font-weight: bold; font-size: 1rem; color: #000; margin-bottom: 0.2rem;">${project.name}</div>
                                        <div style="font-size: 1rem; color: #000; font-style: italic; text-align: justify; line-height: 1.6;">${project.description}</div>
                                    </div>
                                `).join('')}
                            </div>
                        ` : `
                            <div style="margin-bottom: 1.2rem;">
                                <h2 style="font-size: 1.1rem; font-weight: bold; margin: 0 0 0.4rem 0; color: #000; border-bottom: 1px solid #000; padding-bottom: 1px;">Academic Projects</h2>
                                
                                <div style="margin-bottom: 0.8rem;">
                                    <div style="font-weight: bold; font-size: 1rem; color: #000; margin-bottom: 0.2rem;">SecureGuard (National Innovation Challenge)</div>
                                    <div style="font-size: 1rem; color: #000; font-style: italic; text-align: justify; line-height: 1.6;">Developed a comprehensive cybersecurity monitoring application as part of national innovation challenge participation, focusing on real-time threat detection and automated response systems.</div>
                                </div>
                                
                                <div style="margin-bottom: 0.8rem;">
                                    <div style="font-weight: bold; font-size: 1rem; color: #000; margin-bottom: 0.2rem;">TaskMaster - Cross-Platform Task Management</div>
                                    <div style="font-size: 1rem; color: #000; font-style: italic; text-align: justify; line-height: 1.6;">Developed a comprehensive task management application for both mobile and desktop platforms using React Native and Electron. Features include task scheduling, team collaboration, and productivity analytics with modern UI/UX design.</div>
                                </div>
                                
                                <div style="margin-bottom: 0.8rem;">
                                    <div style="font-weight: bold; font-size: 1rem; color: #000; margin-bottom: 0.2rem;">GPA Calculator Pro</div>
                                    <div style="font-size: 1rem; color: #000; font-style: italic; text-align: justify; line-height: 1.6;">Built an academic grade calculation tool using web technologies to compute semester and cumulative GPA with advanced analytics and progress tracking features.</div>
                                </div>
                            </div>
                        `}
                        
                        <!-- Skills Section -->
                        <div style="margin-bottom: 1.2rem;">
                            <h2 style="font-size: 1.1rem; font-weight: bold; margin: 0 0 0.4rem 0; color: #000; border-bottom: 1px solid #000; padding-bottom: 1px;">Skills</h2>
                            <div style="margin-left: 0.2in;">
                                ${AppState.resumeData.skills?.programming_languages?.length ? `
                                    <div style="margin-bottom: 0.3rem; font-size: 1rem; color: #000;">
                                        <span style="font-weight: bold;">• Programming: </span>
                                        <span>${AppState.resumeData.skills.programming_languages.join(', ')}</span>
                                    </div>
                                ` : `
                                    <div style="margin-bottom: 0.3rem; font-size: 1rem; color: #000;">
                                        <span style="font-weight: bold;">• Programming: </span>
                                        <span>Java, Python, JavaScript, C++, HTML, CSS</span>
                                    </div>
                                `}
                                
                                ${AppState.resumeData.skills?.developer_tools?.length ? `
                                    <div style="margin-bottom: 0.3rem; font-size: 1rem; color: #000;">
                                        <span style="font-weight: bold;">• Software: </span>
                                        <span>${AppState.resumeData.skills.developer_tools.join(', ')}</span>
                                    </div>
                                ` : `
                                    <div style="margin-bottom: 0.3rem; font-size: 1rem; color: #000;">
                                        <span style="font-weight: bold;">• Software: </span>
                                        <span>React, Node.js, MongoDB, Git, VS Code, Android Studio</span>
                                    </div>
                                `}
                                
                                <div style="margin-bottom: 0.3rem; font-size: 1rem; color: #000;">
                                    <span style="font-weight: bold;">• Languages: </span>
                                    <span>English (Fluent), Hindi (Fluent), Kannada (Native), Tamil (Conversational)</span>
                                </div>
                                
                                ${AppState.resumeData.skills?.soft_skills?.length ? `
                                    <div style="margin-bottom: 0.3rem; font-size: 1rem; color: #000;">
                                        <span style="font-weight: bold;">• Core Competencies: </span>
                                        <span>${AppState.resumeData.skills.soft_skills.join(', ')}</span>
                                    </div>
                                ` : `
                                    <div style="margin-bottom: 0.3rem; font-size: 1rem; color: #000;">
                                        <span style="font-weight: bold;">• Core Competencies: </span>
                                        <span>Problem Solving, Team Collaboration, Quick Learning, Full-Stack Development</span>
                                    </div>
                                `}
                            </div>
                        </div>
                        
                        <!-- Achievements Section -->
                        <div style="margin-bottom: 1.2rem;">
                            <h2 style="font-size: 1.1rem; font-weight: bold; margin: 0 0 0.4rem 0; color: #000; border-bottom: 1px solid #000; padding-bottom: 1px;">Achievements & Participation</h2>
                            <div style="margin-left: 0.2in;">
                                ${AppState.resumeData.certifications?.length ? 
                                    AppState.resumeData.certifications.map(cert => `
                                        <div style="margin-bottom: 0.3rem; color: #000; font-size: 1rem;">
                                            • ${cert.name}${cert.issuer ? ` - ${cert.issuer}` : ''}${cert.date ? ` (${cert.date})` : ''}
                                        </div>
                                    `).join('') 
                                : `
                                    <div style="margin-bottom: 0.3rem; color: #000; font-size: 1rem;">
                                        • Participated in National Innovation Challenge with project SecureGuard
                                    </div>
                                    <div style="margin-bottom: 0.3rem; color: #000; font-size: 1rem;">
                                        • Participated in Smart India Hackathon 2024
                                    </div>
                                    <div style="margin-bottom: 0.3rem; color: #000; font-size: 1rem;">
                                        • Completed 10-week software development internship at TechCorp Solutions during diploma studies
                                    </div>
                                    <div style="margin-bottom: 0.3rem; color: #000; font-size: 1rem;">
                                        • Winner of inter-college coding competition - CodeFest 2023
                                    </div>
                                `}
                            </div>
                        </div>
                    </div>
                `;
                // After DOM updates, refit with debouncing
                fitResumePreview();
            }
        }

        // Manual zoom controls for resume preview
        function zoomIn() {
            if (AppState.resumeScale < AppState.maxScale) {
                AppState.resumeScale = Math.min(AppState.resumeScale + 0.1, AppState.maxScale);
                applyManualScale();
            }
        }

        function zoomOut() {
            if (AppState.resumeScale > AppState.minScale) {
                AppState.resumeScale = Math.max(AppState.resumeScale - 0.1, AppState.minScale);
                applyManualScale();
            }
        }

        function resetZoom() {
            AppState.resumeScale = 1.0;
            applyManualScale();
        }

        function applyManualScale() {
            const content = document.getElementById('resume-preview-content');
            const indicator = document.getElementById('scale-indicator');
            
            if (content) {
                content.style.transform = `scale(${AppState.resumeScale})`;
                content.style.transformOrigin = 'top center';
            }
            
            if (indicator) {
                indicator.textContent = `${Math.round(AppState.resumeScale * 100)}%`;
            }
            
            // Update zoom control button states
            const zoomInBtn = document.querySelector('.preview-control-btn[onclick="zoomIn()"]');
            const zoomOutBtn = document.querySelector('.preview-control-btn[onclick="zoomOut()"]');
            
            if (zoomInBtn) {
                zoomInBtn.disabled = AppState.resumeScale >= AppState.maxScale;
            }
            if (zoomOutBtn) {
                zoomOutBtn.disabled = AppState.resumeScale <= AppState.minScale;
            }
        }

        // Auto-fit the resume preview (A4 content) into the preview pane
        let fitResumeTimeout;
        function fitResumePreview() {
            // Skip auto-fit if user has manually adjusted scale (not exactly 1.0)
            if (Math.abs(AppState.resumeScale - 1.0) > 0.01) {
                return;
            }
            
            // Debounce to prevent glitching
            clearTimeout(fitResumeTimeout);
            fitResumeTimeout = setTimeout(() => {
                const container = document.querySelector('.resume-preview');
                const content = document.getElementById('resume-preview-content');
                if (!container || !content) {
                    return;
                }

                // Get container dimensions
                const containerRect = container.getBoundingClientRect();
                const styles = window.getComputedStyle(container);
                const padX = parseFloat(styles.paddingLeft) + parseFloat(styles.paddingRight);
                const padY = parseFloat(styles.paddingTop) + parseFloat(styles.paddingBottom);
                
                const availW = Math.max(100, containerRect.width - padX);
                const availH = Math.max(100, containerRect.height - padY - 50); // Reserve space for controls

                // Reset transform temporarily to measure natural size
                const originalTransform = content.style.transform;
                content.style.transform = 'scale(1)';
                content.style.transformOrigin = 'top center';

                // Get content natural dimensions after reset
                setTimeout(() => {
                    const contentRect = content.getBoundingClientRect();
                    const contentW = contentRect.width;
                    const contentH = contentRect.height;

                    if (contentW === 0 || contentH === 0) {
                        content.style.transform = originalTransform;
                        return;
                    }

                    // Calculate scale to fit with some margin (90% of available space)
                    const scaleX = (availW * 0.9) / contentW;
                    const scaleY = (availH * 0.9) / contentH;
                    const scale = Math.min(scaleX, scaleY, 0.8); // Cap at 0.8 to ensure it's readable

                    // Update AppState and apply scale
                    AppState.resumeScale = scale;
                    applyManualScale();
                    
                    console.log('Auto-fit applied:', {
                        availSize: { w: availW, h: availH },
                        contentSize: { w: contentW, h: contentH },
                        scale: scale
                    });
                }, 50); // Small delay to let DOM settle
            }, 150); // Debounce delay
        }

        async function downloadResumePDF() {
            // Ensure libs are present; attempt to load with fallbacks if not
            const libsReady = await ensurePdfLibsLoaded();
            if (!libsReady) {
                alert('PDF libraries failed to load after retries. Please check your connection and try again.');
                return;
            }
            const element = document.getElementById('resume-preview-content');
            if (!element) return;

            // Use html2canvas + jsPDF to create a proper A4 PDF
            const { jsPDF } = window.jspdf || {};
            const html2canvas = window.html2canvas;

            // A4 dimensions in pixels at 96 DPI (web standard)
            const A4_WIDTH_PX = 794; // 210mm at 96 DPI
            const A4_HEIGHT_PX = 1123; // 297mm at 96 DPI
            const PADDING_PX = 57; // 15mm at 96 DPI

            // Create a clean copy of the content for PDF generation
            const tempContainer = document.createElement('div');
            tempContainer.style.position = 'absolute';
            tempContainer.style.left = '-9999px';
            tempContainer.style.top = '0';
            tempContainer.style.width = A4_WIDTH_PX + 'px';
            tempContainer.style.minHeight = A4_HEIGHT_PX + 'px';
            tempContainer.style.backgroundColor = '#ffffff';
            tempContainer.style.fontFamily = '"Times New Roman", serif';
            tempContainer.style.lineHeight = '1.5';
            tempContainer.style.color = '#000';
            tempContainer.style.padding = PADDING_PX + 'px';
            tempContainer.style.margin = '0';
            tempContainer.style.transform = 'none';
            tempContainer.style.boxSizing = 'border-box';
            tempContainer.style.overflow = 'visible';
            tempContainer.style.wordWrap = 'break-word';
            tempContainer.style.fontSize = '14px'; // Ensure consistent font size
            
            // Clone the content without any transforms
            tempContainer.innerHTML = element.innerHTML;
            
            // Add to DOM temporarily
            document.body.appendChild(tempContainer);

            // Wait for fonts and layout to settle
            await new Promise(resolve => setTimeout(resolve, 100));

            try {
                // Get actual dimensions after content is rendered
                const actualWidth = tempContainer.scrollWidth;
                const actualHeight = tempContainer.scrollHeight;
                
                console.log('PDF Generation Debug:', {
                    containerWidth: A4_WIDTH_PX,
                    containerHeight: A4_HEIGHT_PX,
                    actualWidth,
                    actualHeight,
                    padding: PADDING_PX
                });

                // Render with higher scale for crisp text
                const canvas = await html2canvas(tempContainer, {
                    scale: 2,
                    useCORS: true,
                    backgroundColor: '#ffffff',
                    width: actualWidth,
                    height: actualHeight,
                    windowWidth: actualWidth,
                    windowHeight: actualHeight,
                    allowTaint: false,
                    logging: false
                });
                
                const imgData = canvas.toDataURL('image/png');

                // Create A4 PDF in portrait
                const pdf = new jsPDF('p', 'pt', 'a4');
                const pageWidth = pdf.internal.pageSize.getWidth(); // 595.28 points
                const pageHeight = pdf.internal.pageSize.getHeight(); // 841.89 points

                // Calculate scaling to fit the content properly
                const canvasWidthPt = (canvas.width / 2); // Divide by scale factor
                const canvasHeightPt = (canvas.height / 2);
                
                // Scale to fit width with some margin
                const scaleToFit = Math.min(pageWidth / canvasWidthPt, 1.0); // Don't upscale
                const finalWidth = canvasWidthPt * scaleToFit;
                const finalHeight = canvasHeightPt * scaleToFit;
                
                // Center horizontally
                const xOffset = (pageWidth - finalWidth) / 2;

                let position = 0;
                let heightLeft = finalHeight;

                pdf.addImage(imgData, 'PNG', xOffset, position, finalWidth, finalHeight);
                heightLeft -= pageHeight;

                // Add additional pages if content is longer than one page
                while (heightLeft > 0) {
                    position = heightLeft - finalHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', xOffset, position, finalWidth, finalHeight);
                    heightLeft -= pageHeight;
                }

                pdf.save('Resume.pdf');
            } catch (error) {
                console.error('Error generating PDF:', error);
                alert('Error generating PDF. Please try again.');
            } finally {
                // Clean up temporary element
                document.body.removeChild(tempContainer);
            }
        }

        // Career Pathway Functions
        async function generateCareerPathway(careerName) {
            AppState.selectedCareer = { career: careerName };
            AppState.isLoading = true;

            try {
                const result = await callAPI('/api/generate-pathway', {
                    userProfile: AppState.assessmentData,
                    targetCareer: { career: careerName }
                }, 'POST');

                AppState.careerPathway = result.pathway;
                showSection('pathway');
                renderCareerPathway();
            } catch (error) {
                alert('Failed to generate career pathway. Please try again.');
                console.error('Pathway generation error:', error);
            } finally {
                AppState.isLoading = false;
            }
        }

        function renderCareerPathway() {
            const pathwaySection = document.getElementById('pathway');
            pathwaySection.innerHTML = `
                <div class="container">
                    <h2 class="section-title">Career Pathway to ${AppState.selectedCareer?.career}</h2>
                    <p style="text-align: center; color: var(--text-secondary); margin-bottom: 3rem;">
                        Your personalized roadmap to becoming a ${AppState.selectedCareer?.career}
                    </p>
                    
                    <div class="pathway-timeline">
                        ${AppState.careerPathway?.map((step, index) => `
                            <div class="pathway-step">
                                <div class="step-content">
                                    <h3>${step.action}</h3>
                                    <p>${step.details}</p>
                                    <div style="color: var(--accent); font-weight: 600; margin-top: 0.5rem;">
                                        ${step.time} • ${step.cost}
                                    </div>
                                </div>
                                <div class="step-icon">
                                    <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
                                        <path d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
                                    </svg>
                                </div>
                            </div>
                        `).join('') || '<p>No pathway data available</p>'}
                    </div>
                    
                    <div style="text-align: center; margin-top: 2rem;">
                        <button class="btn btn-secondary" onclick="showSection('dashboard')">
                            Back to Dashboard
                        </button>
                    </div>
                </div>
            `;
        }

        // Career Values Quiz Functions
        const careerQualities = [
            { id: "salary", text: "High earning potential" },
            { id: "work_life_balance", text: "A healthy work-life balance" },
            { id: "creativity", text: "Opportunities for creative expression" },
            { id: "leadership", text: "Leadership and management roles" },
            { id: "helping_others", text: "Making a positive impact on society" },
            { id: "job_security", text: "A stable and secure career path" },
            { id: "remote_work", text: "The flexibility to work remotely" },
            { id: "innovation", text: "Working with cutting-edge technology" }
        ];

        let qualityPairs = [];
        let currentPairIndex = 0;
        let qualityChoices = [];

        function initValuesQuiz() {
            // Generate all possible pairs
            qualityPairs = [];
            for (let i = 0; i < careerQualities.length; i++) {
                for (let j = i + 1; j < careerQualities.length; j++) {
                    qualityPairs.push([careerQualities[i], careerQualities[j]]);
                }
            }
            // Shuffle and take first 10 pairs
            qualityPairs = qualityPairs.sort(() => Math.random() - 0.5).slice(0, 10);
            currentPairIndex = 0;
            qualityChoices = [];
            showValuesQuestion();
        }

        function showValuesQuestion() {
            if (currentPairIndex >= qualityPairs.length) {
                analyzeQualities();
                return;
            }

            const question = qualityPairs[currentPairIndex];
            const progress = ((currentPairIndex + 1) / qualityPairs.length) * 100;

            document.getElementById('values-progress').style.width = `${progress}%`;
            document.getElementById('values-question').innerHTML = `
                <h3 style="text-align: center; margin-bottom: 2rem;">What's more important to you?</h3>
                <div class="comparison-pair">
                    <div class="value-option" data-value="${question[0].text}">
                        <h4>${question[0].text}</h4>
                    </div>
                    <div class="value-option" data-value="${question[1].text}">
                        <h4>${question[1].text}</h4>
                    </div>
                </div>
            `;

            // Add click handlers
            document.querySelectorAll('.value-option').forEach(option => {
                option.addEventListener('click', () => {
                    const value = option.getAttribute('data-value');
                    qualityChoices.push(value);
                    currentPairIndex++;
                    setTimeout(() => showValuesQuestion(), 300);
                });
            });
        }

        async function analyzeQualities() {
            try {
                const result = await callAPI('/api/analyze-qualities', { choices: qualityChoices }, 'POST');
                AppState.topValues = result.top_values;

                document.getElementById('values-question').innerHTML = `
                    <h3 style="text-align: center; margin-bottom: 2rem;">Your Top Career Values</h3>
                    <div style="text-align: center;">
                        ${AppState.topValues.map((value, index) => `
                            <div style="margin-bottom: 1rem; padding: 1rem; background: var(--bg-tertiary); border-radius: 8px;">
                                <strong>${index + 1}. ${value}</strong>
                            </div>
                        `).join('')}
                    </div>
                    <div style="text-align: center; margin-top: 2rem;">
                        <button class="btn btn-primary" onclick="showSection('assessment')">Update Assessment</button>
                        <button class="btn btn-secondary" onclick="initValuesQuiz()" style="margin-left: 1rem;">Retake Quiz</button>
                    </div>
                `;
            } catch (error) {
                console.error('Failed to analyze qualities:', error);
            }
        }



        // Assessment Navigation
        function nextAssessmentStep() {
            saveCurrentStep();

            // Basic validation
            const question = assessmentQuestions[AppState.currentStep];
            const currentValue = AppState.assessmentData[question.id];

            if (question.type === 'radio' && !currentValue) {
                alert('Please select an option before continuing.');
                return;
            }
            if ((question.type === 'text' || question.type === 'textarea') && !currentValue?.trim()) {
                alert('Please fill in this field before continuing.');
                return;
            }
            if (question.type === 'checkbox' && (!currentValue || currentValue.length === 0)) {
                alert('Please select at least one option before continuing.');
                return;
            }

            if (AppState.currentStep < AppState.totalSteps - 1) {
                AppState.currentStep++;
                renderAssessmentStep();
            } else {
                console.log('Submitting assessment with data:', AppState.assessmentData);
                submitAssessment();
            }
        }

        function prevAssessmentStep() {
            if (AppState.currentStep > 0) {
                AppState.currentStep--;
                renderAssessmentStep();
            }
        }

        // Initialize Assessment
        function initAssessment() {
            console.log('Initializing assessment...');
            AppState.currentStep = 0;
            AppState.totalSteps = assessmentQuestions.length;
            AppState.assessmentData.careerValues = []; // Ensure array is initialized
            renderAssessmentStep();

            // Add navigation event listeners without delay for better responsiveness
            // Use a slight delay to ensure DOM is rendered
            setTimeout(() => {
                const prevBtn = document.querySelector('.step-navigation .btn-secondary');
                const nextBtn = document.querySelector('.step-navigation .btn-primary');

                if (prevBtn) {
                    prevBtn.onclick = prevAssessmentStep;
                    console.log('Previous button initialized');
                }
                if (nextBtn) {
                    nextBtn.onclick = nextAssessmentStep;
                    console.log('Next button initialized');
                }
            }, 50); // Small delay to ensure DOM updates
        }

        // Add smooth scroll behavior
        document.documentElement.style.scrollBehavior = 'smooth';

        // Initialize Application
        document.addEventListener('DOMContentLoaded', function () {
            console.log('DOM loaded, initializing Skillora app...');
            // Preload PDF libs in background (non-blocking)
            ensurePdfLibsLoaded().catch(() => {/* ignore; handled on demand */});
            
            // Keep resume preview fitted on window resize (debounced)
            let resizeTimeout;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(() => {
                    // Only refit if resume section is active
                    const resumeSection = document.getElementById('resume');
                    if (resumeSection && resumeSection.classList.contains('active')) {
                        fitResumePreview();
                    }
                }, 250);
            });
            
            // Set totalSteps based on actual number of questions
            AppState.totalSteps = assessmentQuestions.length;
            console.log('AppState initialized:', AppState);

            // Initialize navigation first
            initNavigation();

            // Hide assessment-required tabs initially
            hideAssessmentRequiredTabs();

            // Initialize floating chat button
            const floatingChat = document.getElementById('floating-chat');
            if (floatingChat) {
                floatingChat.addEventListener('click', () => {
                    console.log('Floating chat clicked');
                    showSection('chat');
                });
            }

            // Initialize CTA buttons in hero section with immediate response
            document.querySelectorAll('.btn[data-section]').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    console.log('CTA button clicked:', btn);
                    const sectionId = btn.getAttribute('data-section');
                    if (sectionId) {
                        showSection(sectionId);
                    }
                });
            });

            // Initialize assessment when assessment section is shown - remove delay
            const assessmentTab = document.querySelector('[data-section="assessment"]');
            if (assessmentTab) {
                assessmentTab.addEventListener('click', () => {
                    initAssessment(); // Remove setTimeout for immediate response
                });
            }

            // Initialize career discovery when discovery section is shown - remove delay
            const discoveryTab = document.querySelector('[data-section="discovery"]');
            if (discoveryTab) {
                discoveryTab.addEventListener('click', () => {
                    if (!AppState.careerCards || AppState.careerCards.length === 0) {
                        loadCareerCards();
                    } else {
                        renderCareerCards();
                        updateDiscoveryStats();
                    }
                });
            }

            // Initialize values quiz when values section is shown - remove delay
            const valuesTab = document.querySelector('[data-section="values"]');
            if (valuesTab) {
                valuesTab.addEventListener('click', () => {
                    initValuesQuiz(); // Remove setTimeout for immediate response
                });
            }

            // Initialize resume builder when resume section is shown - remove delay
            const resumeTab = document.querySelector('[data-section="resume"]');
            if (resumeTab) {
                resumeTab.addEventListener('click', () => {
                    renderResumeBuilder(); // Remove setTimeout for immediate response
                });
            }

            // Initialize chat when chat section is shown - remove delay
            const chatTab = document.querySelector('[data-section="chat"]');
            if (chatTab) {
                chatTab.addEventListener('click', () => {
                    initChatElements(); // Remove setTimeout for immediate response
                });
            }

            // Add intersection observer for animations
            const observerOptions = {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            };

            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.style.opacity = '1';
                        entry.target.style.transform = 'translateY(0)';
                    }
                });
            }, observerOptions);

            // Observe feature cards for animation
            document.querySelectorAll('.feature-card').forEach(card => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                card.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
                observer.observe(card);
            });
        });
    </script>
</body>

</html>